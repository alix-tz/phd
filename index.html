<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A research (b)log created during my phD in Digital Humanities.">
<meta name="viewport" content="width=device-width">
<title>A research (b)log</title>
<link href="https://alix-tz.github.io/phd/assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="https://alix-tz.github.io/phd/assets/css/code.css" rel="stylesheet" type="text/css">
<link href="https://alix-tz.github.io/phd/assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
<!-- custom font --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bungee&amp;family=Goldman&amp;family=JetBrains+Mono:wght@200&amp;family=Ubuntu+Mono&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&amp;family=Syne:wght@500&amp;display=swap" rel="stylesheet">
<!-- end of custom font --><link href="https://alix-tz.github.io/phd/assets/css/custom.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://alix-tz.github.io/phd/rss.xml">
<link rel="canonical" href="https://alix-tz.github.io/phd/">
<link rel="icon" href="https://alix-tz.github.io/phd/favicon.ico" sizes="32x32">
<link rel="next" href="https://alix-tz.github.io/phd/index-2.html" type="text/html">
<!--[if lt IE 9]><script src="https://alix-tz.github.io/phd/assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="https://alix-tz.github.io/phd/posts/025/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="https://alix-tz.github.io/phd/" title="A research (b)log" rel="home">

        <span id="blog-title">A research (b)log</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="https://alix-tz.github.io/phd/archive.html">Archive</a></li>
                <li><a href="https://alix-tz.github.io/phd/categories/">Tags</a></li>
                <li><a href="https://alix-tz.github.io/phd/rss.xml">RSS feed</a></li>

    

    
    
    </ul></nav></header><main id="content"><div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/025/" class="u-url">025 - Critically reading "The Writing Is on the Wall for Handwriting Recognition"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/025/" rel="bookmark">
            <time class="published dt-published" datetime="2025-11-28T16:50:54-05:00" itemprop="datePublished" title="2025-11-28">2025-11-28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <blockquote>
<p>A little disclaimer for once, because I usually prefer to praise if I name people. I do not know Dan Cohen nor his work, my criticism of his article is not directed against him personally, but rather it takes his text as one example among many of the kind, that develop the same type of discourse and contain the same type of flaws.</p>
</blockquote>
<p>Plus tôt cette semaine, mon collègue Louis-Olivier Brassard m'a demandé mon avis sur le <a href="https://newsletter.dancohen.org/archive/the-writing-is-on-the-wall-for-handwriting-recognition/">dernier billet</a> posté par Dan Cohen, qu'il a intitulé "The Writing Is on the Wall for Handwriting Recognition", ajoutant un sous-titre annonçant la couleur : "One of the hardest problems in digital humanities has finally been solved". J'avais envie de rendre un peu plus public ma lecture critique, donc j'en tire un billet de blog, en français pour une fois.</p>
<p>J'ai lu avec attention cet article car le sujet m'intéresse (forcément), mais je ne cache pas que je débute en général ce genre de lecture avec un a priori négatif. C'est le traitement que je réserve à tous ces postes, de blog ou sur les réseaux sociaux, qui annoncent à tour de bras que l'IA générative a révolutionné ceci ou cela -- ceci et cela étant généralement des problèmes qui ont occupé des chercheur-ses et ingénieur-es depuis des années, et qui donnent lieu à des débats parfois houleux voire insolvables. Tous ces billets contribuent à alimenter l'esbrouffe de l'IA générative et à saper notre capacité collective déjà pas mal usée à développer une pensée critique à son endroit. <!--J'essaie quand même d'être honnête et de faire attention à mes propres biais dans ce que j'en tire ci-dessous.--></p>
<p>Le billet de Dan Cohen fait suite à la sortie de la version 3 de Gemini, le modèle d'IA générative de Google, publicisé comme le modèle de Google "le plus intelligent à date" ("our most intelligent model yet" dit Google). Comme à chaque fois qu'un nouveau modèle de ce type sort, plusieurs utilisateurs partagent les résultats de leur "expérimentation" avec ces modèles. Dan Cohen n'est pas le seul, par exemple Mark Humphries a aussi posté le même jour <a href="https://generativehistory.substack.com/p/gemini-3-solves-handwriting-recognition">un billet sur le sujet</a> intitulé sobrement "Gemini 3 Solves Handwriting Recognition and it’s a Bitter Lesson". J'ai beaucoup vu ces deux billets relayés sur BlueSky, salués par des chercheurs que j'estime occuper des place d'autorité dans le domaine de la transcription automatique. Après avoir lu le billet de Dan Cohen, je me suis retrouvée assez agacée de ces relais : je ne suis pas convaincue que le texte ait été bien lu par ceux qui l'ont relayé sur BlueSky.</p>
<p>A mon avis, le problème du billet que Dan Cohen est double : 1) il développe un discours universel sur un outil qu'il n'a testé que sur sélection minime d'exemples qui ne disent presque rien des problèmes que rencontrent les utilisateurs de la transcription automatique sur les documents anciens, 2) sa démonstration tient sur des arguments fallacieux. </p>
<h3>Un problème de rigueur scientifique</h3>
<p>Sur le premier point tout d'abord. Dan Cohen utilise trois exemples qui ne sont pas du tout représentatifs des défis de la transcription automatique. D'emblée, cela justifierait une note de bas de page à son sous-titre: il dit "l'un des problèmes les plus difficiles des humanités numériques a enfin été résolu", j'ajoute "en ce qui concerne les documents épistollaires rédigés en anglais durant la première moitié du XIXe siècle par des personnalités dont des biographies ont été écrites, voire dont la correspondance à déjà été éditée"<sup id="fnref:precision_inedit"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/025/#fn:precision_inedit">1</a></sup> car c'est ce qu'il a testé. Ca réduit déjà pas mal la portée de ses résultats, non? D'ailleurs, étant donné que le modèle ne parvient pas à transcrire le troisème exemple, on pourrait même ajouter que cela ne concerne en plus que les documents dont la mise en page est simple.<sup id="fnref:standard_layout"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/025/#fn:standard_layout">2</a></sup></p>
<p>Ce premier point est vraiment problématique parce qu'il s'agit d'un texte publié par une personne qui a une autorité scientifique et qui devrait donc faire preuve de rigueur scientifique, même si ce texte n'est qu'une newsletter et pas un article ou un ouvrage édité. J'attendrais de cette rigueur scientifique qu'on se limite à tirer des conclusions sur ce que l'on a réussi à démontrer au lieu de jouer les Cassandre avec des titres tape-à-l'oeil. On peut avoir la conviction que Gemini est capable de traiter avec succès bien d'autres cas que ceux présentés par Dan Cohen, mais cela relève de la croyance, pas de la démonstration scientifique. Je pense que c'est un sujet qui doit être discuté plus largement, dans un contexte où l'IA nous est messianiquement servie à toutes les sauces, mais Marcello Vitali-Rosati en parle bien dans <a href="https://blog.sens-public.org/marcellovitalirosati/2025-11-htr.html">son dernier billet</a> ou encore, sous un autre angle et qui sort des usages par le monde académique, il y a le récent travail d'<a href="https://www.polytechnique-insights.com/tribunes/digital/comment-se-proteger-du-syndrome-de-stockholm-technologique-face-a-lia/">Hamilton Mann</a>.</p>
<p>Il se trouve que le jour où Louis-Olivier m'a demandé de lire le texte de Dan Cohen, j'avais aussi lu celui de <a href="https://digitalorientalist.com/2025/11/25/teaching-bengali-digital-texts-to-anglophone-undergraduates-what-voyant-reveals-about-the-infrastructural-bias-of-dh-tools/">Sunayani Bhattacharya</a> qui a formé ses élèves du Saint Mary’s College en Californie à l'analyse de texte avec <a href="https://voyant-tools.org/">Voyant Tools</a> et qui traite aussi de transcription automatique au détour de son billet. Elle explique que, dans l'optique de proposer une ouverture vers le Sud Global à ses étudiant-es, elle les a fait travailler sur des textes en Bengali (même si aucun ne sait parler ou lire le Bengali). Je trouve l'exercice intéressant et prometteur tel qu'elle le présente. Après avoir développé chez ses élèves une familiarité avec ce à quoi ressemble les textes de presse correctement édités dans Voyant Tools, elle leur a montré ce qu'on obtient quand on tente de faire tourner Voyant Tools sur des textes directement sortis d'un logiciel d'OCR. Ces textes contiennent énormément de bruit et parfois n'utilisent même pas les bons jeux de caractères. Cela lui permet de donner un exemple très concret à ses étudiant-es des limites des infrastructures logicielles dès qu'il s'agit de traiter de textes en langues indiennes. Elle conclut en redisant l'utlité de donner aux étudiant-es une meilleure idée de ce à quoi ressemblent les biais anglophones dans la technologie quand on est sur le terrain. Dans un texte comme celui dont je discute dans ce billet, ce biais anglophone (et j'ajouterai même moderniste) saute aux yeux.</p>
<h3>Une démonstration bancale</h3>
<p>Maintenant, concernant le deuxième point, il suppose de regarder d'un peu plus près ce que Dan Cohen nous dit et les exemples qu'il donne. Il y a des imprécisions qui doivent être relevées, mais aussi des extraits qui ne correspondent pas aux affirmations qui sont faites dans le billet. </p>
<p>Une imprécision qui commence justement par la question de la précision des modèles. J'en ai déjà parlé dans <a href="https://alix-tz.github.io/phd/posts/012/">un précédent billet</a> car il me semble que c'est l'un des sujets où les chercheurs font le plus preuve de paresse : de quelle précision on parle, et quelles sont les limites de ces mesures de précision ? Dan Cohen affirme que "les meilleurs logiciel d'HTR ont du mal à atteindre 80% de précision". Comme il clarifie que cela signifie 2 mots faux tous les 10 mots, déjà on s'aperçoit qu'il nous parle de taux d'erreur au mot et non au caractère. Un tel taux d'erreur ne dit rien de la lisibilité du texte puisqu'une seule erreur suffit pour que le mot soit compté comme faux. Dans une phrase comme "the hardest problem in digtial humaities has finolly beeen sol ved", un mot sur deux contient une faute, pourtant il me semble que la phrase est parfaitement lisible. Pour mettre les choses en perspective, le taux de précision au caractère dans cette phrase, lui, est de 90.77% (d'après un logiciel comme <a href="https://huggingface.co/spaces/lterriel/kami-app">KaMI</a>). En plus de cette imprécision de départ, l'affirmation de Dan Cohen sur les difficultés des logiciels traditionnels me semble fause. Je ne vois sur quelle source il se base. Pour des documents comme ceux qu'il teste, on est bien au-delà des 80% de précision, y compris au mot, et ce avec plusieurs modèles et plusieurs logiciels.</p>
<p>Comme cette affirmation m'a surprise, j'ai voulu regarder si vraiment le modèle de Transkribus avait fait autant de fautes que ça. Bien sûr, il a fait des erreurs. Quand on regarde le document source, on voit que certaînes sont compréhensibles dans un contexte zero-shot: lorsque Boole trace deux "l" à la suite, son deuxième "l" ressemble à un "e" avec une boucle très très petite. C'est ce qui explique que la prédiction de Transkribus contient des erreurs sur "tell" (lu "tele") sur la page de gauche, et "All" (lu "Ale") sur la page de droite. Pour savoir quelle était vraiment l'ampleur des erreurs de Transkribus, j'ai proposé ma propre transcription de la double page, ligne par ligne (en suivant l'ordre des lignes tiré de la segmentation dans Transkribus, et en m'aidant un peu de la lecture proposé par Gemini). Quand je calcule le taux de précision sur cet extrait, j'obtiens une précision au caractère d'environ 95,1% et une précision au mot de 88%.<sup id="fnref:precision_error_tkb"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/025/#fn:precision_error_tkb">3</a></sup> Largement perfectible donc, mais on n'est pas dans une situation catastrophique comme le laisse supposer le préambule.</p>
<p>Maintenant, si on regarde la transcription de Gemini, on s'aperçoit qu'il y a en fait aussi des erreurs, alors que Dan Cohen nous dit "Gemini transcribed the letter perfectly". Par exemple, Gemini transcrit, sur la page de droite, "occasionally by" (Transkribus l'avait transcrit "occasion by"), en générant comme précision complémentaire dans une section de notes que "On the right page (line 8), the handwriting becomes very scribbled. It appears to say 'take a long walk occasionally try &amp; once or twice...' or possibly 'occasionally by &amp; once or twice...'." Donc Gemini, échoue ici à proposer de lire une césure qui fait pourtant sens et préfère ajouter un mot dans sa transcription. Le problème ce n'est pas que Gemini n'ai pas fait une transcription parfaite bien sûr, mais plutôt que Dan Cohen l'affirme sans relever cette erreur.</p>
<p>On a le même problème dans le deuxième exemple, où Gemini met en forme le mot "transmitted" pour signaler qu'il est barré alors que ce n'est pas le cas dans la source. Le texte généré par Gemini ne laisse pas de doute vis-à-vis de l'aspect du texte dans la source et invente une intention de la part de l'auteur : "In the second line of the body, the word 'transmitted' is crossed out in the original text, but the sentence is grammatically incomplete without it (or a similar verb). It is likely the author meant to replace it to avoid repetition with the word 'transmitting' appearing a few lines later but forgot to insert the new word." Alors que cette erreur était plus facile à repérer, Dan Cohen nous dit pourtant encore une fois : "Another perfect job."</p>
<p>Le coup de grâce à mon avis vient avec le troisième exemple. Gemini n'en propose pas de transcription, et génère un message indiquant que le texte est illisible passé un certain point, ce qui permet à Dan Cohen d'en conclure : "Gemini does the right thing here: rather than venture a guess like a sycophantic chatbot, it is candid when it can’t interpret a section of the letter." Personnellement, je m'étouffe en lisant ça, vu les erreurs déjà notées dans les deux exemples précédents. Au contraire de ce qu'affirme Dan Cohen, il n'y a pas de candeur ici, mais plutôt une effet pervers de ce que j'imagine être un calibrage du modèle en fonction de son taux de perplexité. Dans les deux premiers exemples, on peut imaginer que la perplexité du modèle face à certains passages difficiles conduit à la génération d'une note et/ou d'un insert entre crochets, mais n'empêche pas la génération d'une transcription fausse. Elle passe d'autant plus inaperçue que les explications générées en notes sont fausses et sonnent bien. On n'a donc pas affaire à un robot candide, mais à un chatbot arnaqueur. Et à mon avis il serait vraiment temps que ses utilisateurs l'intègrent, en ayant la main d'autant moins légère quand ils contrôlent ce que génèrent ces outils.</p>
<p>Je n'ai pas encore lu le <a href="https://generativehistory.substack.com/p/gemini-3-solves-handwriting-recognition">billet</a> de Mark Humphries que je mentionnais tout au début, mais j'aurais peut-être l'occasion de revenir encore sur le sujet. A vrai dire, ce que je trouve vraiment vraiment dommage avec ces publications, issues du monde académique, qui contribuent à alimenter l'hystérie autour de l'IA générative, c'est qu'elle me donne l'impression que décidément ce n'est même pas de la part de la communauté scientifique que viendra le Salut. En tant que citoyenne et jeune chercheuse, cela m'inquiète beaucoup.  </p>
<div class="footnote">
<hr>
<ol>
<li id="fn:precision_inedit">
<p>Je donne cette précision sur l'édition des biographie et des correspondance car elle me semble importante: Dan Cohen n'a pas pris des documents dont on est sûr qu'ils soient inédits. Etant donné que les modèles d'IA générative sont entraînés à partir de tout ce qui peut être trouvé sur le Web, cela veut dire que ces lettres ont peut-être d'une manière ou d'une autre, fait partie des lots utilisés pour l'entraînement. Par exemple, <a href="https://foinse.ucc.ie/en/records/IE/BL/PP/BP/1/A/1/1/51?utm_source=dancohen&amp;utm_medium=email&amp;utm_campaign=the-writing-is-on-the-wall-for-handwriting-recognition">sur le site</a> des Archives du University College of Cork, d'où est tirée la numérisation de la lettre de Boole, on trouve le texte suivant dans le champ description : "Boole in Cork to Maryann. He is in a very depressed mood, life has become monotonous with only his work adding interest to the day. He enjoys playing the piano but 'it would be better with someone else to listen and to be listened to'. He is also very annoyed by [Cropers] dedicating his book to him without first asking for permission - 'I cannot help feeling that he has taken a great liberty' - and speaks in strong terms of [Cropers] 'pretensions to high morality'. He invites and urges Maryann to visit him as soon as their mother's health would allow. He feels the climate would do her good." Ce sont des éléments de contexte qui peuvent aider, y compris un modèle, au moment de transcrire. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/025/#fnref:precision_inedit" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:standard_layout">
<p>Je ne dis pas "mise en page standard", parce que le phénomène qui est illustré par le troisième exemple, le fait de réécrire sur la même feuille après l'avoir tournée à 90°, correspond à une pratique qu'on retrouve au moins jusqu'au milieu du XXe siècle. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/025/#fnref:standard_layout" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:precision_error_tkb">
<p>Parmi les erreurs de Transkribus, on peut aussi noter l'utilisation d'un "<a href="https://www.compart.com/en/unicode/U+0432">в</a>" (le v cyrillique) pour transcrire le "B" de la côte du document. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/025/#fnref:precision_error_tkb" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/024/" class="u-url">024 - The messy backstage of a literature review</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/024/" rel="bookmark">
            <time class="published dt-published" datetime="2025-06-21T15:15:27-04:00" itemprop="datePublished" title="2025-06-21">2025-06-21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>A few weeks ago, I began a thorough review of articles published in four digital humanities venues to track mentions of automatic text recognition and understand how, where, and why scholars use it. Although I wish I had started sooner in my doctoral journey, I stay positive holding on to the idea that "it's never too late." I learn a lot about Digital Humanities as a field of research and gain a better understanding of ATR's presence in the field.</p>
<p>While catching up on our dissertation progress, I was telling Roch Delanney about the survey I'm conducting, my goals for it, and how I selected and sorted the articles. Roch suggested that I share my method more widely. It seems a little clumsy at times, but I am also able to use many different skills I have learned and sharpened over the years so I think it is indeed interesting to share a bit of my <em>cuisine</em>.</p>
<h3>Perimeter of the literature review</h3>
<p>My literature review focuses on four publication venues. I think they are, collectively, representative of research in the Digital Humanities: </p>
<ul>
<li>
<p><a href="https://academic.oup.com/dsh"><em>Digital Scholarship in the Humanities</em></a> (DSH), which is presented by the Alliance of Digital Humanities Organizations (ADHO) as an international, peer-reviewed journal published by Oxford University Press on behalf of ADHO and the European Association for Digital Humanities (EADH). It was published under the title <em>Literary and Linguistic Computing: The Journal of Digital Scholarship in the Humanities</em> until 2014. I counted a total of 174 volumes for a total of 1741 articles (excluding retracted articles, book reviews, editorials and committee reports) published since 1985 until the first half of 2025.</p>
</li>
<li>
<p><a href="https://dhq.digitalhumanities.org/"><em>Digital Humanities Quarterly</em></a> (DHQ) is an open-access peer-reviewed journal, probably more representative of research in North America. It is published by the Association for Computers and the Humanities (ACH). I counted a total of 790 articles published since its first issue in 2007. Most articles are in English.</p>
</li>
<li>
<p>The <a href="https://jdmdh.episciences.org/"><em>Journal of Data Mining and Digital Humanities</em></a> (JDMDH), is published by Episciences since 2017. Contrary to DHQ, its focus is more European-centric, and it has a special volume dedicated specifically to automatic text recognition (directed by Ariane Pinche and Peter Stokes). I found a total of 162 articles published in JDMDH, including the special volume on ATR.</p>
</li>
<li>
<p>Lastly, the proceedings from the more recent <em>Computational Humanities Research</em> (CHR) conferences (see the <a href="https://2024.computational-humanities-research.org/">2024 conference proceedings</a> for example) offer a perspective on research focused on more intensively computational methods in the Humanities. The conference is held annually since 2021. I found a total of 214 articles in the proceedings.</p>
</li>
</ul>
<p>Aside from DSH, that I can access thanks to the library of the University of Montréal, all the other journals are in open access. </p>
<h3>Collecting the articles and their metadata</h3>
<p>For JDMDH, articles are not centralized on the journal website but rather published on platforms like <a href="https://hal.archives-ouvertes.fr/">HAL</a> or <a href="https://arxiv.org/">arXiv</a> and sometimes <a href="https://zenodo.org/">Zenodo</a>. Getting an overview of the articles published in JDMDH is not straightforward, but it is possible to browse the articles per <a href="https://jdmdh.episciences.org/browse/volumes">volumes</a>. I opened and downloaded each article in each volume, as well as collected the article entries in Zotero using the Zotero connector. The process was cumbersome and required many clicks, but the variety of publishing platforms deterred me from writing a script to automate the downloading process.  </p>
<p>CHR, on the other hand, was very easy to scrape, partly because there are only four volumes of proceedings so far. For each series of proceeding, the index of all articles is compatible with the batch import scenario of the Zotero connector. To collect the PDFs, I used a section of the HTML page and regular expressions to identify the links to the PDF files, creating a list of URLs. Finally, I used a Python script to download the PDFs to my computer.  </p>
<p>For example, in <a href="https://ceur-ws.org/Vol-2989/">https://ceur-ws.org/Vol-2989/</a>, the <code>ul</code> contains simple HTML elements pointing to the PDF files, such as: </p>
<div class="code"><pre class="code literal-block"><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"CEURSESSION"</span><span class="p">&gt;</span>Presented papers<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">id</span><span class="o">=</span><span class="s">"long_paper5"</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"long_paper5.pdf"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"CEURTITLE"</span><span class="p">&gt;</span>Entity Matching in Digital Humanities Knowledge
      Graphs<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"CEURPAGES"</span><span class="p">&gt;</span>1-15<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"CEURAUTHOR"</span><span class="p">&gt;</span>Juriaan Baas<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>,
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"CEURAUTHOR"</span><span class="p">&gt;</span>Mehdi M. Dastani<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>,
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"CEURAUTHOR"</span><span class="p">&gt;</span>Ad J. Feelders<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
...
</pre></div>

<p>All I had to do was copy and paste this entire list into a text editor (I like to use <a href="https://www.sublimetext.com/">Sublime Text</a> in such a situation). Then, I used a simple regular expression like <code>href=".+?"</code> to select the value in the <code>a</code> element, which contains the links to the PDF files. I kept only the selected text and then rebuilt the complete URL with a couple of replacements such as <code>href="</code> -&gt; <code>"https://ceur-ws.org/Vol-2989/</code> and <code>"\n</code> -&gt; <code>",\n</code>. At this point I just added square brackets around the selection, et voilà! I had a Python list ready to be passed to a script like the one below to download the files:</p>
<div class="code"><pre class="code literal-block"><span class="n">list_of_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://ceur-ws.org/Vol-2723/short8.pdf"</span><span class="p">,</span>
                <span class="s2">"https://ceur-ws.org/Vol-2723/long35.pdf"</span><span class="p">,</span>
                <span class="s2">"https://ceur-ws.org/Vol-2723/long44.pdf"</span><span class="p">,</span>
                <span class="c1">#...</span>
                <span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span> <span class="c1"># it makes  progress bar so I know how long I can take to make a tea while the script runs</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">list_of_urls</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="c1">#print(filename)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to download: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># This cool down is to be polite to the server</span>
</pre></div>

<p>I used a similar approach for downloading the articles from DHQ because the <a href="https://dhq.digitalhumanities.org/index/title.html">Index of Titles</a> lists all of the published articles on a single page. I first downloaded the HTML pages of the articles (DHQ publishes articles in HTML format as well as PDF). I also used regular expressions to extract the list of links and used a Python script to download the files.  </p>
<p>Unfortunately, the Zotero connector only works on each article page individually, but not for batch-import on the index page. I investigated a bit to understand why it was so, and found that in the source code of each article page, there is a <code>span</code> element identified with the class <code>Z3988</code> that the Zotero connector uses to extract the metadata and create an entry in Zotero. In DHQ, these spans look like this:</p>
<div class="code"><pre class="code literal-block"><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"Z3988"</span> <span class="na">title</span><span class="o">=</span><span class="s">"url_ver=Z39.88-2004&amp;amp;ctx_ver=Z39.88-2004&amp;amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;amp;rfr_id=info%3Asid%2Fzotero.org%3A2&amp;amp;rft.genre=article&amp;amp;rft.atitle=Academics%20Retire%20and%20Servers%20Die%3A%20Adventures%20in%20the%20Hosting%20and%20Storage%20of%20Digital%20Humanities%20Projects&amp;amp;rft.jtitle=Digital%20Humanities%20Quarterly&amp;amp;rft.stitle=DHQ&amp;amp;rft.issn=1938-4122&amp;amp;rft.date=2023-05-26&amp;amp;rft.volume=017&amp;amp;rft.issue=1&amp;amp;rft.aulast=Cummings&amp;amp;rft.aufirst=James&amp;amp;rft.au=James%20Cummings"</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>

<p>I understood recently, while discussing with Margot Mellet, that Z3988 is a reference to the <a href="https://groups.niso.org/higherlogic/ws/public/download/14833/z39_88_2004_r2010.pdf">OpenURL Framework Standard (ISO Z 39.88-2004)</a>, which is used by the Zotero connector. Also, I should note that such spans are not systematically used in online journals. JDMDH for example doesn't use them, and serves the metadata in a different way.  </p>
<p>Since I had already downloaded all the articles from DHQ as HTML files, I wrote a simple Python script that found all of such spans for each downloaded article and aggregated them in a single, very simple HTML file. Then, I simply opened this page in my browser after emulating a local server<sup id="fnref:python_server"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/024/#fn:python_server">1</a></sup> (with a command like <code>python -m http.server</code>), and I was able to use the Zotero connector to import all the articles in a single click. It was very satisfying! The only downside is that I couldn't collect the articles' abstracts because there weren't included in the spans.  </p>
<p>DSH was different from the rest of the journals. Because of the longevity of the journal and the amount of articles it published, it was quite overwhelming. Unfortunately, it is a paywalled journal and I couldn't figure out how to make the proxy of the University of Montreal library work with my Python scripts and the command line. As a result, I had to manually download the articles,<sup id="fnref:proxy_dsh"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/024/#fn:proxy_dsh">2</a></sup> but only when they were relevant! Since DSH has a fairly good search engine that allows to do multi-keyword searches, I only downloaded articles matching my search criteria (143 in total).</p>
<p>Additionally, I went through each of the 174 issues of DSH to batch-import the article references in Zotero. It was tedious but I figured I might be able to use these metadata for other projects in the future.  </p>
<h3>Filtering the articles</h3>
<p>For DHQ, JDMDH and CHR, I ran a keyword surch using the command <a href="https://www.man7.org/linux/man-pages/man1/grep.1.html"><code>grep</code></a> on the content of the articles. I didn't want to limit my search to the titles, abstract or keywords because I really wanted to include anecdotal mentions of automatic text recognition in my results.  </p>
<p>To use grep, I created a file (pattern.txt) with the keywords I was looking for:  </p>
<div class="code"><pre class="code literal-block">HTR
OCR
text recognition
ATR
Transkribus
eScriptorium
automatic transcription
</pre></div>

<p>Then I converted the PDFs into text files using the command <a href="https://man.archlinux.org/man/pdftotext.1.en">pdftotext</a>. This was necessary because grep cannot search inside a PDF directly. I didn't need to do this conversion for DHQ, since I had download HTML files from that journal. </p>
<p>The commands to search inside the PDFs of one of the journals would look like this:</p>
<div class="code"><pre class="code literal-block">ls<span class="w"> </span>*.pdf<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n1<span class="w"> </span>pdftotext<span class="w"> </span><span class="c1"># to convert PDFs to text files</span>
grep<span class="w"> </span>-i<span class="w"> </span>-w<span class="w"> </span>-m5<span class="w"> </span>-H<span class="w"> </span>-f<span class="w"> </span>../pattern.txt<span class="w"> </span>*.txt<span class="w"> </span><span class="c1"># to search for the keywords in the text files and display the first 5 matches</span>
</pre></div>

<p>After controlling how grep matched the keywords, I used <code>grep -l -f ../pattern.txt *.txt</code> to list the files that matched the keywords. This list was used to sort the documents into two folders, according to whether or not they matched my research.</p>
<p>In the case of DSH, I directly used the search engine to combine the keywords, using the "OR" operator. I set the full text of the articles as the scope of my research: <a href="https://academic.oup.com/dsh/search-results?allJournals=1&amp;f_ContentType=Journal+Article&amp;fl_SiteID=5447&amp;cqb=[{%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22automatic%20transcription%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22transkribus%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22text%20recognition%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22escriptorium%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22OCR%22}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22HTR%22}]}]&amp;qb={%22_text_1-exact%22:%22automatic%20transcription%22,%22qOp2%22:%22OR%22,%22_text_2-exact%22:%22transkribus%22,%22qOp3%22:%22OR%22,%22_text_3-exact%22:%22text%20recognition%22,%22qOp4%22:%22OR%22,%22_text_4-exact%22:%22escriptorium%22,%22qOp5%22:%22OR%22,%22_text_5%22:%22OCR%22,%22qOp6%22:%22OR%22,%22_text_6%22:%22HTR%22}&amp;page=1">https://academic.oup.com/dsh/search-results?allJournals=1&amp;f_ContentType=Journal+Article&amp;fl_SiteID=5447&amp;cqb=[{%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22automatic%20transcription%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22transkribus%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22text%20recognition%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22escriptorium%22,%22exactMatch%22:true}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22OCR%22}]},{%22condition%22:%22OR%22,%22terms%22:[{%22filter%22:%22_text_%22,%22input%22:%22HTR%22}]}]&amp;qb={%22_text_1-exact%22:%22automatic%20transcription%22,%22qOp2%22:%22OR%22,%22_text_2-exact%22:%22transkribus%22,%22qOp3%22:%22OR%22,%22_text_3-exact%22:%22text%20recognition%22,%22qOp4%22:%22OR%22,%22_text_4-exact%22:%22escriptorium%22,%22qOp5%22:%22OR%22,%22_text_5%22:%22OCR%22,%22qOp6%22:%22OR%22,%22_text_6%22:%22HTR%22}&amp;page=1</a></p>
<p>In both cases, the search was not case sensitive, in order to catch a maximum of occurrences of keywords like "automatic text recognition" or "Text Recognition" or "text recognition", etc. However, it meant that sometimes I found false positives: "democracy" often matches with "ocr", so does "theatre" with "atr". Since DSH's search engine returns the match in context, I was able to ignore these false positives. For the other journals, I had to manually check where the matches were. Usually, I combined this control with the next step of my investigation.  </p>
<h4>Hits per journal</h4>
<ul>
<li>JDMDH: 47 hits (out of 162 articles)</li>
<li>DHQ: 93 hits (out of 790 articles)</li>
<li>DSH: 143 relevant hits (out of 1741 articles)</li>
<li>CHR: 65 hits (out of 214 articles)</li>
</ul>
<h3>
<em>Dépouillement</em> and analysis</h3>
<p>To this date, I am still in the process of reading the articles and taking notes on the occurrences of my keywords. </p>
<p>I use Zotero to keep track of the articles I read and to confirm whether they are false positives. Sometimes, I leave out articles that are irrelevant, even if they mention a keyword I was looking for. For example, <a href="https://doi.org/10.1093/llc/fqac089">Liu &amp; Zhu (2023)</a><sup id="fnref:liu_zhu_2023"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/024/#fn:liu_zhu_2023">3</a></sup> contains the string "OCR" but it only appears in a title in their bibliography, for work they refer to in a context where OCR is not relevant to their argument. With tags in Zotero, I clearly identify such articles as "to be left out" from my analysis, but I don't remove them from the collection.  </p>
<p>I use different tags to identify the various occurrences of the technology in the articles. For example, I distinguish between firsthand applications of ATR and the reuse of data produced by ATR before the experimentation presented by the authors. Typically, there are many mentions of documents that were OCRed by libraries and used by scholars to conduct their research. Overall, with this analysis, I am trying to add more depth to the observations made by <a href="https://doi.org/10.48550/arXiv.2304.13530">Tarride et al (2023)</a><sup id="fnref:tarride_et_al_2023"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/024/#fn:tarride_et_al_2023">4</a></sup> in which they pragmatically considered three situations leading to the use of ATR: 1) for the production of digital editions; 2) for the production of large searchable text corpora; and 3) for the production of non-comprehensive transcriptions to feed knowledge bases. However, it is difficult to elaborate definitive categories before I am done processing all the collected articles.  </p>
<p>Due to the large number of articles to be analyzed, I have continued to use the grep command to quickly review the content of articles and speed up my sorting process. For example, I am more interested in firsthand usages of ATR, want to be able to quickly identify non relevant mentions of my keywords as was the case in Liu &amp; Zhu (2023). The command <code>grep -i -w -C 5 -H -f ../pattern.txt *.txt &gt; grep_out</code> allows me to generate a file, grep_out, in which, for each time a keyword is matched in a document, five lines of context are displayed before and after the match, as well as the name of the file. I still have to read the abstracts and parts of the articles to clearly understand in which contexts the automatic text recognition technologies are used. However, this is an effective method for quickly sorting through the articles.</p>
<p>I'm looking forward to sharing the results of this analysis in my dissertation! </p>
<!-- FOOTNOTES --->

<div class="footnote">
<hr>
<ol>
<li id="fn:python_server">
<p>This emulation is necessary to allow the Zotero connector to work properly. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/024/#fnref:python_server" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:proxy_dsh">
<p>I want to specify here that it was not by lack of reading documentations on proxies and requests. Unable to find a straightforward solution, unsure if it was even something that the UdeM proxy allowed, and because I would have still needed to write additional scripts afterwards, I decided that it would take just as long to do it manually (about 2-3 hours). <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/024/#fnref:proxy_dsh" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:liu_zhu_2023">
<p>Liu, Lei, and Min Zhu. "Bertalign: Improved Word Embedding-Based Sentence Alignment for Chinese–English Parallel Corpora of Literary Texts." <em>Digital Scholarship in the Humanities</em> 38, no. 2 (June 1, 2023): 621–34. <a href="https://doi.org/10.1093/llc/fqac089">https://doi.org/10.1093/llc/fqac089</a>. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/024/#fnref:liu_zhu_2023" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:tarride_et_al_2023">
<p>Tarride, Solène, Mélodie Boillet, and Christopher Kermorvant. "Key-Value Information Extraction from Full Handwritten Pages." arXiv, April 26, 2023. <a href="https://doi.org/10.48550/arXiv.2304.13530">https://doi.org/10.48550/arXiv.2304.13530</a>. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/024/#fnref:tarride_et_al_2023" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/023/" class="u-url">023 - Writing a PhD manuscript with Markdown and Quarto</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/023/" rel="bookmark">
            <time class="published dt-published" datetime="2025-02-18T00:00:00-05:00" itemprop="datePublished" title="2025-02-18">2025-02-18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The deadline for finishing the dissertation is approaching. And there is still so much to do! This is one of the main reasons why this research blog has been quiet for the last few months, even though there are many topics I would like to write about. </p>
<p>But I guess I can take a short break from time to time and go with the flow of writing a blog post in one sitting. Who knows, maybe I'll do a few more before it's time to turn in my dissertation. I want to talk about my writing setup because it is something I have thought about a lot, trying to find the best compromise. </p>
<p>Writing my dissertation in Microsoft Word has never been an option, although I do use Google Docs from time to time to get quick feedback from my supervisors. </p>
<p><a href="https://www.latex-project.org/">LaTeX</a> may seem like an obvious choice to some of my fellow PhD writers, but I usually limit my use of LaTeX to <a href="https://www.overleaf.com">Overleaf</a>, an online LaTeX editor. On the one hand, I didn't necessarily want to install LaTeX locally for the time being, and on the other hand, I couldn't imagine writing a whole dissertation using Overleaf, because working in my browser can be distracting, and because it would require that I always have access to the Internet to work. To be honest, I mostly didn't want to use LaTeX in the first place because I find the syntax too distracting when I'm writing. It's super useful for getting good control over the layout of the document for the final version of the manuscript, but it's not convenient to work with while I'm formulating ideas and arguments.</p>
<p>I will probably use LaTeX to prepare the final version of the manuscript, but I wanted to use something lighter to structure my document, but easily convertible to LaTeX down the road. </p>
<p>And I am a big fan of Markdown.</p>
<p>Markdown has a syntax that is light enough not to be too distracting - I use it all the time when taking notes anyway, so it is fully part of my writing reflexes. Also, in the context of writing my dissertation, I think of Markdown as text that I can easily copy and paste into a Google document when I need feedback, without losing formatting and without compromising readability in Google Docs. I've seen some LaTeX copy-pasted into Google Docs for supervisor feedback, and I don't think it would work for me. </p>
<p>In addition to Markdown, I wanted to be able to use a modular approach to building my manuscript. A modular approach means having several smaller text files that are eventually merged into a single master document. LaTeX also relies on modularity with commands like <code>\include{}</code>. Modularity is important because in a very long text document it is easy to get lost between inline comments, draft passages, and finished paragraphs. There's also the risk of accidentally deleting passages. With a modular structure, it will also be easier to move paragraphs around as I progress. Also, my manuscript is versioned with Git and synchronized with a private GitHub repository, and modularity makes versioning much easier.</p>
<p>Instead of programming my own manuscript builder - yes, that was my first impulse - I took a closer look at the documentation for <a href="https://quarto.org/">Quarto</a>, which I've been using for a little over a year to create slides and websites for the courses I teach. Quarto offered me a solution on a silver platter, because it supports building <a href="https://quarto.org/docs/reference/projects/books.html">books</a> with Markdown, which is close enough to a phD thesis. </p>
<p>Quarto implements a single-source publishing paradigm and acts as a shell around <a href="https://pandoc.org/">pandoc</a>, which allows for swift conversion from one format to another, including from Markdown to LaTeX. I can split the document into multiple smaller Markdown files, and use my book's config file to specify the order in which the Markdown files are aggregated. Quarto's Markdown implementation includes some cool stuff from pandocs, including citation and cross-reference management. It's really worth taking a look at the documentation.</p>
<p>So with Quarto, I can write my dissertation as a series of smaller Markdown files, and end up with a master .md file, a .tex file ready to import into Overleaf, or even an already parsed PDF file generated with <a href="https://quarto.org/docs/output-formats/pdf-engine.html">tinytex</a>. </p>
<p>Quarto is not a text editor, it is simply a processor that starts with a set of markdown files and a config file, and then builds one or more outputs. To write, I use Visual Studio Code and have a <code>quarto preview</code> command running in the background. For now, it just produces an HTML preview that I see in my browser. When I'm closer to a stable version of the manuscript, I'll start working with PDF output.</p>
<p>The syntax for some of the more specific Markdown features in Quarto is more complex than I am used to, so I still have to look at the documentation from time to time. But I am getting the hang of it, and I use a cheat sheet for the features I use more often. </p>
<p>Pandoc's Markdown support lets you apply classes to entire paragraphs or inline portions of text. This is useful because it has allowed me to create some CSS transformations with classes like "draft" or "missing-information" to keep track of passages I need to rewrite, or blocks where I need to get away from my text editor and go back to my notes (usually in <a href="https://www.zotero.org/">Zotero</a>). I find it super useful to avoid (at least as much as possible) falling into loopholes that distract me from actually writing. It's more efficient for my time management to divide my time between actual writing sessions and other sessions where I work on improving the drafty passages or doing the research I'm missing to illustrate an argument. </p>
<p>Another use of inline classes is to keep track of concepts or specific terms that I could include in a glossary or at least a list of acronyms. By keeping track of them directly in the text, I can automate the generation of these sections. Some might say that this is the kind of thing I could do with <a href="https://tei-c.org/release/doc/tei-p5-doc/en/html/index.html">TEI XML</a>- I agree, since this is semantic annotation. But as I said, I wanted a lightweight syntax, and I really like Markdown.  </p>
<p><em><strong>EDIT from June 20, 2025:</strong> I feel the need to add a precision a few months after this original post: while I did like my set up with Markdown and Quarto to get started on writing my dissertation, I eventually switched to the good old LaTeX. Quarto/Markdown simply lacked too many features for what I wanted to do.</em> </p>
<p><em>Part of the problem came from the fact that custom annotations that turn into spans with custom classes during a Markdown-to-HTML transformation scenario were not converted into anything in LaTeX and were therefore lost. For example, I would have needed to manage the glossary and acronym handler afterwards, only once I was done with Markdown and fully switched to LaTeX. Rather than writing my own preprocessing script to find a solution to this problem (as far as I could see, pandoc does not offer any option to map markdown spans to custom LaTeX commands), I figured swithing to writing in LaTeX directly made more sense: there was no point in pushing too far the complications.</em></p>
<p><em>Also, I really wanted to be able to use the <code>todo</code> package from LaTeX to keep track of feedback, side notes and questions I had for myself while writing. With this package, they are visible in the PDF output, which is useful also when I share my text with other people.</em></p>
<p><em>Lastly, Roch Delanney greatly facilitated this switch by sharing his LaTeX template with me. It was easy to start from the setup he created with Robert Alessi and to add my own configuration and customization. Their template was much more pure than templates that can be found on Overleaf, on top of being very well documented. It was great to keep things simple: I don't import any package that I don't actually need.</em></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/022/" class="u-url">022 - McCATMuS #5 - Training models</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/022/" rel="bookmark">
            <time class="published dt-published" datetime="2024-09-23T00:00:00-04:00" itemprop="datePublished" title="2024-09-23">2024-09-23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Last week, I visited Rimouski in the Bas-Saint-Laurent region of Québec, along the South-eastern bank of the St Laurent river. I was invited to contribute to discussions around the <a href="https://nouvellefrancenumerique.info/">Nouvelle-France Numérique project</a>, and I took this opportunity to <a href="https://inria.hal.science/hal-04706828">present</a> HTR-United, CATMuS as well as preliminary results on training a McCATMuS model. In preparation for this presentation, I conducted a series of tests on the two first models I trained. Today, this blog post gives me a space to discuss these tests and their results in more details.</p>
<p>The Kraken McCATMuS models were not directly trained on the HuggingFace dataset I introduced in my <a href="https://alix-tz.github.io/phd/posts/022/021/">previous post</a>, but rather on ARROW files created with the same ALTO XML files used to create the HuggingFace dataset. At the beginning of September, I wrote a Python script which reproduces the split of ALTO XML files into the train, validation and test sets, and which applies the same type of filtering of lines and modifications as I previously presented. Instead of generating the PARQUET files for HuggingFace, it simply creates alternative <code>.catmus_arrow.xml</code> files and three listings of these files, ready to be served to a <a href="https://kraken.re/4.3.0/ketos.html#binary-datasets"><code>ketos compile</code></a> command<sup id="fnref:compile"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/022/#fn:compile">1</a></sup>.</p>
<p>I used Kraken 4.3.13 to train the models on Inria's computation server because I've had dependency issues with Kraken 5 and haven't fixed them yet. The first model I trained strictly followed the train/validation split thanks to the <a href="https://github.com/mittagessen/kraken/blob/cdfb923eba8d7dba10b6f32fb73bdf1e355aaf74/kraken/ketos/recognition.py#L129C16-L129C30"><code>--fixed-splits</code> option</a>. After 60 epochs, the model plateaued at 79.9% of character accuracy. When applied to the test set, this accuracy remained at 78.06%, a mere two points drop.</p>
<p>I trained a second model using the same parameters<sup id="fnref:params"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/022/#fn:params">2</a></sup> but without the <code>--fixed-splits</code> option, allowing Kraken to shuffle the train set and the validation set into a 90/10 split (the test set was left untouched however). This time, the training lasted 157 epochs before stopping, with the best model scoring with an accuracy of 92.8% on the validation set. When applied to the test set however, the model lost 7 points of accuracy (85.24%).</p>
<figure><img src="https://alix-tz.github.io/phd/images/mccatmus_v1_entra%C3%AEnement_fixedsplits.png" alt="Learning curve for the model trained on the fixed split."><figcaption>Learning curve (Character and Word Accuracies) for the model trained on the fixed "feature"-based split between train and validation.</figcaption></figure><figure><img src="https://alix-tz.github.io/phd/images/mccatmus_v1_entra%C3%AEnement.png" alt="Learning curve for the model trained on the non-fixed split."><figcaption>Learning curve (Character and Word Accuracies) for the model trained on the random split between train and validation.</figcaption></figure><p>Although disappointing, this was consistent with the observations made when training the CATMuS Medieval model:</p>
<blockquote>
<p><em>As anticipated, the "General" split exhibits lower CER, given the absence of out-of-domain documents, whereas the "Feature"-based split surpasses 10%. This higher score presents an intriguing challenge for developing more domain-specific models that consider factors such as script type and language.</em> (from <a href="https://univ-paris8.hal.science/hal-04453952v1">Thibault Clérice, Ariane Pinche, Malamatenia Vlachou-Efstathiou, Alix Chagué, Jean-Baptiste Camps, et al.. CATMuS Medieval: A multilingual large-scale cross-century dataset in Latin script for handwritten text recognition and beyond. 2024 International Conference on Document Analysis and Recognition (ICDAR), 2024, Athens, Greece. ⟨hal-04453952⟩</a> p. 15)</p>
</blockquote>
<p>So, the drop in accuracy observed on the test set is, as suggested in <em>Clérice et al, 2024</em>, likely due to the fact that with a fixed-split, the model is both validated and tested against out-of-domain hands and documents (although the documents differ in the two sets). On the other hand, the model trained with a random split is validated against known hands and documents, but tested on out-of-domain examples.</p>
<p>The test set contains transcriptions of printed, typewritten and handwritten texts, covering all centuries. Limiting ourselves to only one accuracy score obtained on the whole test set would tell us very little about the model's capacity and its limitations. This is why I divided the test set into several smaller test sets based on the century of the documents and/or on the main type of writing present in the documents. For documents spanning over several centuries, I used the most represented century.</p>
<p>I only used the McCATMuS trained on the random split for these tests, because the accuracy of the other one was too low for the results to be meaningful. Instead of only testing McCATMuS, I also ran the Manu McFrench V3 and McFondue on the McCATMuS test set. They are two generic models trained on similar data (although with no or different normalization approaches).</p>
<table>
<thead><tr>
<th style="text-align: left;">Test set..............</th>
<th style="text-align: left;">...McCATMuS...</th>
<th style="text-align: center;">...Manu McFrench V3...</th>
<th style="text-align: right;">...McFondue</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: left;">All...................</td>
<td style="text-align: left;">...85.24...</td>
<td style="text-align: center;">...<strong>91.17</strong>...</td>
<td style="text-align: right;">...76.12</td>
</tr>
<tr>
<td style="text-align: left;">Handwritten...........</td>
<td style="text-align: left;">...78.72...</td>
<td style="text-align: center;">...<strong>89.40</strong>...</td>
<td style="text-align: right;">...75.17</td>
</tr>
<tr>
<td style="text-align: left;">Print.................</td>
<td style="text-align: left;">...<strong>96.37</strong>...</td>
<td style="text-align: center;">...94.15...</td>
<td style="text-align: right;">...78.30</td>
</tr>
<tr>
<td style="text-align: left;">Typewritten...........</td>
<td style="text-align: left;">...90.93...</td>
<td style="text-align: center;">...<strong>92.69</strong>...</td>
<td style="text-align: right;">...58.13</td>
</tr>
<tr>
<td style="text-align: left;">17th cent.............</td>
<td style="text-align: left;">...<strong>87.27</strong>...</td>
<td style="text-align: center;">...86.39...</td>
<td style="text-align: right;">...72.81</td>
</tr>
<tr>
<td style="text-align: left;">18th cent.............</td>
<td style="text-align: left;">...88.65...</td>
<td style="text-align: center;">...<strong>94.21</strong>...</td>
<td style="text-align: right;">...81.64</td>
</tr>
<tr>
<td style="text-align: left;">19th cent.............</td>
<td style="text-align: left;">...79.81...</td>
<td style="text-align: center;">...<strong>93.70</strong>...</td>
<td style="text-align: right;">...75.46</td>
</tr>
<tr>
<td style="text-align: left;">20th cent.............</td>
<td style="text-align: left;">...74.92...</td>
<td style="text-align: center;">...<strong>86.52</strong>...</td>
<td style="text-align: right;">...56.74</td>
</tr>
<tr>
<td style="text-align: left;">21st cent.............</td>
<td style="text-align: left;">...73.86...</td>
<td style="text-align: center;">...<strong>90.20</strong>...</td>
<td style="text-align: right;">...68.04</td>
</tr>
<tr>
<td style="text-align: left;">(HW) 17th cent........</td>
<td style="text-align: left;">...58.69...</td>
<td style="text-align: center;">...<strong>64.83</strong>...</td>
<td style="text-align: right;">...<em>64.26</em>
</td>
</tr>
<tr>
<td style="text-align: left;">(HW) 18th cent........</td>
<td style="text-align: left;">...85.38...</td>
<td style="text-align: center;">...<strong>93.35</strong>...</td>
<td style="text-align: right;">...80.47</td>
</tr>
<tr>
<td style="text-align: left;">(HW) 19th cent........</td>
<td style="text-align: left;">...79.81...</td>
<td style="text-align: center;">...<strong>93.70</strong>...</td>
<td style="text-align: right;">...75.46</td>
</tr>
<tr>
<td style="text-align: left;">(HW) 20th cent........</td>
<td style="text-align: left;">...63.02...</td>
<td style="text-align: center;">...<strong>82.23</strong>...</td>
<td style="text-align: right;">...55.89</td>
</tr>
<tr>
<td style="text-align: left;">(HW) 21st cent........</td>
<td style="text-align: left;">...73.86...</td>
<td style="text-align: center;">...<strong>90.20</strong>...</td>
<td style="text-align: right;">...68.04</td>
</tr>
</tbody>
</table>
<!-- add plot? --><p>I was initially surprised by the consistent margin Manu McFrench had over McCATMuS, considering it was trained on less data (73.9K + 8.8K lines, against the 106K + 5.8K lines) which had not been harmonized to follow the same transcription rules. However, these scores are actually biased in favor of Manu McFrench because several of the documents included in the McCATMuS test set were also used in Manu McFrench's train set. Even though this is not true for all documents, it concerns almost half of the test set. It might also be the case for McFonddue, but this model scores higher than McCATMuS in only one instance (handwritten documents from the 17th century). Creating a new test set, with documents that are not present in any of the train sets but follow the CATMuS guidelines, would be a good way to confirm this bias.</p>
<p>Additionally, I detected an issue in one of the datasets used in the test set: <code>FoNDUE_Wolfflin_Fotosammlung</code> contains some lines of faulty transcriptions, resulting from automatic text recognition, which most certainly cause an inaccurate evaluation of all three models.</p>
<blockquote>
<p><em>A couple of examples of the faulty transcriptions, along with their CER they generate when compared to what would be a correct transcription (the CER is generated with <a href="https://github.com/WHaverals/CERberus">CERberus</a>):</em></p>
<table>
<thead><tr>
<th style="text-align: left;">Line image</th>
<th style="text-align: right;">Faulty transcription</th>
<th style="text-align: right;">Correct transcription</th>
<th style="text-align: center;">Faulty CER would be</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: left;"><img alt='text line images reading, in print, "COLLECTION HANFSTAENGL LONDON"' src="https://alix-tz.github.io/phd/images/fotosammlung_error_example1.jpg"></td>
<td style="text-align: right;">"CSTITHER, KIESERMAEAER AogS."</td>
<td style="text-align: right;">"COLLECTION HANFSTAENGL LONDON"</td>
<td style="text-align: center;">89.29</td>
</tr>
<tr>
<td style="text-align: left;"><img alt='text line image reading, in print, "NATIONAL GALLERY"' src="https://alix-tz.github.io/phd/images/fotosammlung_error_example2.jpg"></td>
<td style="text-align: right;">"PEcLioL."</td>
<td style="text-align: right;">"NATIONAL GALLERY"</td>
<td style="text-align: center;">175.0</td>
</tr>
</tbody>
</table>
</blockquote>
<p>I have planned to manually control this dataset and update the McCATMuS dataset accordingly. I don't know yet how many lines are affected.</p>
<p>The better accuracy of the Manu McFrench model is not just a product of the biases in the test set. I had the occasion to apply it to two documents, one from the 17th century and one from the 20th century. In both cases, Manu McFrench's transcription seemed more likely to be correct than McCATMuS's. This has led me to compare the training parameters used for both models and to start a third training experiment using Manu McFrench's parameters. In this case, the batch size is reduced to 16 (as opposed to 32) and the Unicode normalization follows <a href="https://unicode.org/reports/tr15/#Compatibility_Composite_Figure">NFKD instead of NFD</a>.</p>
<p>If the results of this third training are consistent with the previous experiments, it will be interesting to see if adding more data to the training set will improve the results. Also, I have yet to test the model in a situation of finetuning.</p>
<p>As said at the beginning of this post, these results are preliminary, so I hope to have more to share in the coming weeks.</p>
<!-- footnotes -->

<div class="footnote">
<hr>
<ol>
<li id="fn:compile">
<p>The command looks like this: cat "./list_of_paths.txt" | xargs -d "\n" ketos compile -o "./binary_dataset.arrow" --random-split .0 .0 1.0 -f alto. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/022/#fnref:compile" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:params">
<p>The configuration of Kraken for training these two model relies on the default network architecture, on a NFD Unicode normalization, a learning rate of 0.0001 (1e<sup>-4</sup>), batch size of 32, padding of 16 (default value), and applies augmentation (<code>--augment</code>). The <code>--fixed-splits</code> option is used for the first model. Following Kraken's default behavior, the training stops when the validation loss does not decrease for 10 epochs (early stops); this prevents the model from overfitting, which is confirmed when looking at the accuracy score of the intermediary models on the test set (orange line on the graphs). The training is done on a GPU. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/022/#fnref:params" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/021/" class="u-url">021 - McCATMuS #4 - Cleaning data, collection metadata</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/021/" rel="bookmark">
            <time class="published dt-published" datetime="2024-08-30T00:00:00-04:00" itemprop="datePublished" title="2024-08-30">2024-08-30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Preparing the data for CATMuS would certainly have taken much more time had I not been able to benefit from Thibault Clérice's experience with CATMuS Medieval. Not only was I able to build on the workflow he set up when he built it, but I also relied heavily on his scripts to parse and build the final dataset into <a href="https://parquet.apache.org/">PARQUET</a> files that were pushed to HuggingFace. Most of these steps are described in <a href="https://univ-paris8.hal.science/hal-04453952v1">Thibault Clérice, Ariane Pinche, Malamatenia Vlachou-Efstathiou, Alix Chagué, Jean-Baptiste Camps, et al.. CATMuS Medieval: A multilingual large-scale cross-century dataset in Latin script for handwritten text recognition and beyond. 2024 International Conference on Document Analysis and Recognition (ICDAR), 2024, Athens, Greece</a>, presented at the <a href="https://icdar2024.net/">ICDAR</a> conference in Athens in a few days.</p>
<p>For McCATMuS, I started by downloading all the datasets (keeping track of the official releases) then I manually reorganized all the datasets so that the transcription and images were always under <code>{dataset_repo}/data/{sub_folder}</code>, which made later manipulation easier. Based on the notes I took while filtering the datasets, and after generating a character table for each dataset with <a href="https://github.com/PonteIneptique/choco-mufin">Chocomufin</a>, I created several conversion tables to harmonize the transcription. The conversions are a mix of single character or multiple character replacements (<code>[</code> and  <code>[[?]]</code>) and more or less sophisticated replacements based on regular expressions (<code>#r#«</code>).<sup id="fnref:chocomufin"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/021/#fn:chocomufin">1</a></sup></p>
<p>Here is a sample of the Chocomufin conversion table used for the LECTAUREP datasets. If the character is replaced by itself, it remains unchanged in the dataset, while replacing it allows either to remove a character from the dataset (the <code>¥</code>) or to harmonize its transcription with the CATMuS guidelines (see <code>œ</code> and <code>°</code> for example).</p>
<div class="code"><pre class="code literal-block"><span class="nc">char</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">replacement</span><span class="p">,</span><span class="n">codepoint</span><span class="p">,</span><span class="n">mufidecode</span><span class="p">,</span><span class="k">order</span>
<span class="n">#r</span><span class="err">#«</span><span class="w"> </span><span class="p">,</span><span class="n">Repl</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="nf">space</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="nf">LEFT</span><span class="o">-</span><span class="n">POINTING</span><span class="w"> </span><span class="k">DOUBLE</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="n">QUOTATION</span><span class="w"> </span><span class="n">MARK</span><span class="p">,</span><span class="ss">""""</span><span class="p">,</span><span class="mi">00</span><span class="n">AB</span><span class="p">,,</span><span class="mi">0</span>
<span class="n">#r</span><span class="err">#</span><span class="w"> </span><span class="err">»</span><span class="p">,</span><span class="n">Repl</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="nf">space</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="nf">RIGHT</span><span class="o">-</span><span class="n">POINTING</span><span class="w"> </span><span class="k">DOUBLE</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="n">QUOTATION</span><span class="w"> </span><span class="n">MARK</span><span class="p">,</span><span class="ss">""""</span><span class="p">,</span><span class="mi">00</span><span class="n">BB</span><span class="p">,,</span><span class="mi">0</span>
<span class="o">[</span><span class="n">[?</span><span class="o">]</span><span class="err">]</span><span class="p">,</span><span class="nf">replace</span><span class="w"> </span><span class="o">[</span><span class="n">[?</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="err">⟦⟧</span><span class="p">,</span><span class="err">⟦⟧</span><span class="p">,,,</span><span class="mi">0</span>
<span class="o">[</span><span class="n">?</span><span class="o">]</span><span class="p">,</span><span class="nf">replace</span><span class="w"> </span><span class="o">[</span><span class="n">?</span><span class="o">]</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="err">⟦⟧</span><span class="p">,</span><span class="err">⟦⟧</span><span class="p">,,,</span><span class="mi">0</span>
<span class="p">),</span><span class="nf">RIGHT</span><span class="w"> </span><span class="n">PARENTHESIS</span><span class="p">,),</span><span class="mi">0029</span><span class="p">,),</span>
<span class="n">m</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">006</span><span class="n">D</span><span class="p">,</span><span class="n">m</span><span class="p">,</span>
<span class="n">É</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">CAPITAL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">ACUTE</span><span class="p">,</span><span class="n">É</span><span class="p">,</span><span class="mi">00</span><span class="n">C9</span><span class="p">,</span><span class="n">E</span><span class="p">,</span>
<span class="n">a</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">0061</span><span class="p">,</span><span class="n">a</span><span class="p">,</span>
<span class="ss">","</span><span class="p">,</span><span class="n">COMMA</span><span class="p">,</span><span class="ss">","</span><span class="p">,</span><span class="mi">002</span><span class="n">C</span><span class="p">,</span><span class="ss">","</span><span class="p">,</span>
<span class="n">e</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">0065</span><span class="p">,</span><span class="n">e</span><span class="p">,</span>
<span class="o">^</span><span class="p">,</span><span class="n">CIRCUMFLEX</span><span class="w"> </span><span class="n">ACCENT</span><span class="p">,</span><span class="o">^</span><span class="p">,</span><span class="mi">005</span><span class="n">E</span><span class="p">,</span><span class="o">^</span><span class="p">,</span>
<span class="n">œ</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LIGATURE</span><span class="w"> </span><span class="n">OE</span><span class="p">,</span><span class="n">oe</span><span class="p">,</span><span class="mi">0153</span><span class="p">,</span><span class="n">oe</span><span class="p">,</span>
<span class="err">̂</span><span class="p">,</span><span class="n">COMBINING</span><span class="w"> </span><span class="n">CIRCUMFLEX</span><span class="w"> </span><span class="n">ACCENT</span><span class="p">,</span><span class="err">̂</span><span class="p">,</span><span class="mi">0302</span><span class="p">,,</span>
<span class="n">W</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">CAPITAL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">W</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="mi">0057</span><span class="p">,</span><span class="n">W</span><span class="p">,</span>
<span class="err">°</span><span class="p">,</span><span class="n">DEGREE</span><span class="w"> </span><span class="nf">SIGN</span><span class="p">,</span><span class="o">^</span><span class="n">o</span><span class="p">,</span><span class="mi">00</span><span class="n">B0</span><span class="p">,</span><span class="o">*</span><span class="p">,</span>
<span class="err">¥</span><span class="p">,</span><span class="n">YEN</span><span class="w"> </span><span class="nf">SIGN</span><span class="p">,,</span><span class="mi">00</span><span class="n">A5</span><span class="p">,,</span>
<span class="n">½</span><span class="p">,</span><span class="n">VULGAR</span><span class="w"> </span><span class="n">FRACTION</span><span class="w"> </span><span class="n">ONE</span><span class="w"> </span><span class="n">HALF</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">00</span><span class="n">BD</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span>
<span class="n">h</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="mi">0068</span><span class="p">,</span><span class="n">h</span><span class="p">,</span>
<span class="n">r</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="mi">0072</span><span class="p">,</span><span class="n">r</span><span class="p">,</span>
<span class="n">æ</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">AE</span><span class="p">,</span><span class="n">ae</span><span class="p">,</span><span class="mf">00E6</span><span class="p">,</span><span class="n">ae</span><span class="p">,</span>
<span class="n">ȼ</span><span class="p">,</span><span class="n">LATIN</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">LETTER</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">STROKE</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">023</span><span class="n">C</span><span class="p">,</span><span class="n">c</span><span class="p">,</span>
<span class="err">∟</span><span class="p">,</span><span class="nf">RIGHT</span><span class="w"> </span><span class="n">ANGLE</span><span class="p">,,</span><span class="mi">221</span><span class="n">F</span><span class="p">,</span><span class="o">[</span><span class="n">UNKNOWN</span><span class="o">]</span><span class="p">,</span>
</pre></div>

<p>It wasn't possible to use a single conversion table for all the datasets because some had different transcription approaches. While replacing  <code>¬</code> with <code>-</code> could, in principle, be used for each dataset, normalizing the way corrections and uncertainties were transcribed was another story. For example, in some of the CREMMA datasets, <code>&gt;&lt;</code> is used to signal a crossed word, while in other datasets <code>&lt;&gt;</code> is used. So replacing <code>&gt;</code> with <code>⟦</code> and <code>&lt;</code> with <code>⟧</code> in <code>&gt;hello&lt;</code> meant that in some cases we would successfully get <code>⟦hello⟧</code>, while in other cases we would end up with <code>⟧hello⟦</code>. There are a few documents where I had to manually intervene in the XML file to fix the transcription. In such cases, I fork the dataset repository to keep track of the corrected version of the ground truth or I push the correction back into the original dataset to create a new, more consistent version.</p>
<p>In general, the converted dataset is saved as <code>.catmus.xml</code> files, which allows us to keep track of the original ground truth and easily adjust the conversion table later if necessary afterwards.</p>
<p>In the <a href="https://alix-tz.github.io/phd/posts/19/">second post</a> of this series, I mentioned that "<em>the CATMuS guidelines can (should?) be used as a reference point</em>" and that "<em>if a project decides to use a special character to mark the end of each paragraph, then in order to create a CATMuS-compatible version of the dataset, I should only have to replace or remove that character. In such cases, the special character that was chosen should be unambiguous and the rule should be explicitly presented</em>." Providing a Chocomufin conversion table along with a dataset that uses project-specific guidelines would be an excellent practice to ensure that the dataset is indeed compatible with CATMuS.</p>
<p>Once all the <code>.catmus.xml</code> files were ready, I created a new metadata table for McCATMuS listing all the subdirectories under each dataset's "data" folder. This table was used as a basis to start collecting additional metadata at the document level rather than at dataset level, like the language used in the source or the type of writing (printed, handwritten or typewritten). Working at the document level is important because some dataset contain different types of writing and/or are multilingual. In some cases, when a document would mix different languages and/or different types of writing in the source, if the distinction could be made at the image level, I manually sorted them and created two different subfolders. This is what I did in the "Memorials for Jane Lathrop Stanford" dataset, for example: the subfolder "PageX-LettreX" mixed typewritten and handwritten letters, so I sorted them into "PageX-LettreX-handwritten" and "PageX-LettreX-typewritten" in order to have the most accurate metadata possible.</p>
<p>Other metadata included the assignment of a call number (or shelf mark) for each source represented in the datasets. In some cases a call number may apply to multiple subfolders, but in most cases, each subfolder is de facto a different document. Retrieving the call number is useful for several reasons: it allows for an accurate assessment of the diversity of documents in McCATMuS, it allows for a document to be associated with additional metadata found in its institution's catalog, or the list of call numbers can be used during benchmarking or production to check whether a document is known to the models trained on that dataset, thus explaining potentially higher accuracy scores.</p>
<p>In the few cases where the source used to build the ground truth did not have a corresponding call number, I simply made one up, keeping "nobs_" as a signal that it was a made-up call number. Thus, if "cph_paris_tissage_1858/" in "timeuscorpus" is now associated with its corresponding call number at the Paris archive center (Paris, AD75, D1U10 386), CREMMAWiki's "batch-04", which is composed of documents we created for the project, is associated with a made-up call number: "nobs_cremma-wikipedia_b04".</p>
<p>In the end, when the PARQUET files are created, the metadata from the table I just presented is collected, along with information extracted from parsing the contents of the XML file. Each of the metadata is then represented at the text line level. If you compare <a href="https://huggingface.co/datasets/CATMuS/modern">McCATMuS</a> with <a href="https://huggingface.co/datasets/CATMuS/medieval">CATMuS Medieval</a> using HuggingFace's dataset viewer, you can see that they don't use exactly the same metadata.</p>
<p>"Language", "region type" and "line type" (which are based on the segmOnto classification), "project" and "gen_split" are common to both datasets, along with "shelfmark" I just described above. They both have a "genre" column with similar values (treatise, epistolary, document of practice, etc.). In the case of CATMuS Medieval, "genre" is complemented by "verse" (prose, verse).</p>
<p>Following Thibault's advice, I defined the creation date of a text line using two numbers ("not_before" and "not_after") instead of a single "century" value. This allows for a precise dating when it is possible or on the contrary, to spread the dating over several centuries when it cannot be avoided, which is more accurate in both cases.</p>
<p>McCATMuS mixes printed, handwritten and typewritten documents, so it was important to have a "writing type" column to help filter the dataset based on this information, in cases where one does not want to mix them. This metadata also makes it possible to use McCATMuS to train a classifier capable of distinguishing between the different types of writing. CATMuS Medieval on the other hand presents only handwritten sources, so such a metadata would be useless and is able to rely on paleographic classifications to characterize each text line based on a "script type" metadata, that includes values such as "caroline", "textualis", "hybrida", etc.</p>
<p>McCATMuS also has a "color" column that helps sort text lines based on whether the source image is colored (true) or in grayscale (false).</p>
<p>Although I reused the scripts developed by Thibault to build this dataset, I had to make several modifications to include this new metadata in the PARQUET files and to add additional filtering to the text lines. This included updating the mapping to the segmOnto vocabulary to match what existed in my datasets, or filtering some types of lines such as those identified as signatures.<sup id="fnref:signatures"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/021/#fn:signatures">2</a></sup> I also included an update of "writing_type" at the line level whenever the value in "line_type" allowed it to be controlled. </p>
<div class="code"><pre class="code literal-block"><span class="k">if</span> <span class="s2">":handwritten"</span> <span class="ow">in</span> <span class="n">line_type</span><span class="p">:</span>
    <span class="n">writing_type</span> <span class="o">=</span> <span class="s2">"handwritten"</span>
    <span class="n">line_type</span> <span class="o">=</span> <span class="n">line_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">":handwritten"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">elif</span> <span class="s2">":print"</span> <span class="ow">in</span> <span class="n">line_type</span><span class="p">:</span>
    <span class="n">writing_type</span> <span class="o">=</span> <span class="s2">"printed"</span>
    <span class="n">line_type</span> <span class="o">=</span> <span class="n">line_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">":print"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">elif</span> <span class="s2">":typewritten"</span> <span class="ow">in</span> <span class="n">line_type</span><span class="p">:</span>
    <span class="n">writing_type</span> <span class="o">=</span> <span class="s2">"typewritten"</span>
    <span class="n">line_type</span> <span class="o">=</span> <span class="n">line_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">":typewritten"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">writing_type</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">"writing_type"</span><span class="p">]</span>
</pre></div>

<p>In the end, having built such a dataset (the first version of McCATMuS contains 117 text lines!) with such a variety of metadata is very satisfying although there is room for improvement. I have already mentioned that it would be interesting to have a greater variety of languages in McCATMuS. I also know that some of the values in "writing_type" are not completely accurate so adding a control based on a classifier might be interesting. Finally, I've noticed that some transcriptions in the "FoNDUE_Wolfflin_Fotosammlung" dataset are not correct at all, probably due to an automatic transcription that wasn't corrected.</p>
<p>However, before we dive into improving McCATMuS, it's important to first examine the accuracy of the models that can be built on top of it! This will be the topic of the next and last post in this series!</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:chocomufin">
<p>To learn more about how <a href="https://github.com/PonteIneptique/choco-mufin?tab=readme-ov-file#commands"><code>chocomufin convert</code></a> works, just read the software's short documentation. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/021/#fnref:chocomufin" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:signatures">
<p>I don't think it makes sense to include signatures in a dataset to train a generic model, since the transcription of such lines can be very context specific. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/021/#fnref:signatures" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/020/" class="u-url">020 - McCATMuS #3 - Datasets selection</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/020/" rel="bookmark">
            <time class="published dt-published" datetime="2024-08-29T00:00:00-04:00" itemprop="datePublished" title="2024-08-29">2024-08-29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>HTR-United made identifying candidate datasets for McCATMuS a piece of cake. Once the rest of the CATMuS community agreed with the period to be covered by a "modern and contemporary" dataset, I created a simple script to parse the content of the HTR-United catalog and make a list of existing datasets covering documents written in Latin alphabet and matching our time criteria. </p>
<p>Actually, here is the script!</p>
<div class="code"><pre class="code literal-block"><span class="n">url_latest_htrunited</span><span class="o">=</span><span class="s2">"https://raw.githubusercontent.com/HTR-United/htr-united/master/htr-united.yml"</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># get latest htr-united.yml from main repository</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_latest_htrunited</span><span class="p">)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">in_time_scope</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>
    <span class="n">century_scope_min</span> <span class="o">=</span> <span class="mi">1600</span>
    <span class="n">century_scope_max</span> <span class="o">=</span> <span class="mi">2100</span>
    <span class="c1"># this means that we allow datasets that intersect with the period</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"notBefore"</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">century_scope_min</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"notAfter"</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">century_scope_min</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"notBefore"</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">century_scope_max</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"notAfter"</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">century_scope_max</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="n">filtered_by_date</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">catalog</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">in_time_scope</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"time"</span><span class="p">,</span> <span class="p">{})):</span>
        <span class="n">filtered_by_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_by_date</span><span class="p">)</span><span class="si">}</span><span class="s2"> entries matching the time scope."</span><span class="p">)</span>

<span class="n">targeted_script</span> <span class="o">=</span> <span class="s2">"Latn"</span>
<span class="n">filtered_by_script</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">filtered_by_date</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">targeted_script</span> <span class="ow">in</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"iso"</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"script"</span><span class="p">)]:</span>
        <span class="n">filtered_by_script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_by_script</span><span class="p">)</span><span class="si">}</span><span class="s2"> entries matching the script criteria."</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Script Type"</span><span class="p">,</span> <span class="s2">"Time Span"</span><span class="p">,</span> <span class="s2">"Languages"</span><span class="p">,</span> <span class="s2">"Repository"</span><span class="p">,</span> <span class="s2">"Project Name"</span><span class="p">,</span> <span class="s2">"Dataset Name"</span><span class="p">]</span>

<span class="n">metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

<span class="n">selected_entries</span> <span class="o">=</span> <span class="n">filtered_by_script</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">selected_entries</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="s2">""</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">}</span>
    <span class="n">languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"language"</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Languages"</span><span class="p">]</span> <span class="o">=</span> <span class="n">languages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Languages"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Couldn't find a field for language in this repository"</span><span class="p">)</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Languages"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"no language"</span>
    <span class="c1"># get centuries/y</span>
    <span class="n">row</span><span class="p">[</span><span class="s2">"Time Span"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"notBefore"</span><span class="p">)</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"notAfter"</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>
    <span class="n">row</span><span class="p">[</span><span class="s2">"Project Name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"project-name"</span><span class="p">,</span> <span class="s2">"no project name"</span><span class="p">)</span>
    <span class="n">repository</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"url"</span><span class="p">,</span> <span class="s2">"no url found"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">repository</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"https://github.com/"</span><span class="p">):</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Repository"</span><span class="p">]</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"https://github.com/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">repository</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"https://zenodo.org/"</span><span class="p">):</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Repository"</span><span class="p">]</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"https://zenodo.org/"</span><span class="p">,</span> <span class="s2">"zenodo:"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Repository"</span><span class="p">]</span> <span class="o">=</span> <span class="n">repository</span>
    <span class="n">row</span><span class="p">[</span><span class="s2">"Dataset Name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="s2">"no title found"</span><span class="p">)</span>
    <span class="n">script_type</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"script-type"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">script_type</span> <span class="o">==</span> <span class="s2">"only-typed"</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Script Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Print"</span>
    <span class="k">elif</span> <span class="n">script_type</span> <span class="o">==</span> <span class="s2">"only-manuscript"</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Script Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Handwritten"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">"Script Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Mixed"</span>
    <span class="n">metadata_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata_df</span><span class="p">)]</span> <span class="o">=</span> <span class="n">row</span>

<span class="n">metadata_df</span>
</pre></div>

<p>I saved the output as a CSV and proceeded to go through each of the selected datasets and its metadata. I checked several things:</p>
<ul>
<li>I made sure the datasets were available and easy to download. For example, I excluded those requiring manual image retrieval.</li>
<li>I checked the format of the data because I decided to initially focus only on datasets available in ALTO XML and PAGE XML.</li>
<li>I controlled the overall compatibility between the transcription guidelines used for the dataset and those designed by CATMuS.</li>
<li>I also checked the conformity of the dataset when trying to import it into eScriptorium. This import allowed me to detect when there was a discrepancies between the names of the image files and the value for the source image in the XML file which prevented the import from successfully running.<sup id="fnref:images"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/020/#fn:images">1</a></sup>
</li>
<li>Loading a sample of the dataset in eScriptorium also allowed me to visually control other incompatibilities with CATMuS that may not have been documented by the producers of the data.<sup id="fnref:segmentation"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/020/#fn:segmentation">2</a></sup>
</li>
<li>Finally, I considered the structure of the repository and, when necessary, the facility to reorganize it into a single <code>data/</code> folder containing the images and the XML files, often distributed among sub-folders.</li>
</ul>
<p>I assigned each dataset a priority number from 1 to 6. The lowest number was for dataset compatible with CATMuS without any modification (no dataset was giving a priority rank of 1...) and 6 for massive datasets that would require a nerve-racking script to be built correctly. My grading system is shown below.</p>
<ul>
<li>1=ready as is</li>
<li>2=need to be <a href="https://github.com/PonteIneptique/choco-mufin">chocomufin</a>-ed</li>
<li>3=require manual corrections but the dataset is very small, or the dataset is chocomufin/catmus compatible but requires a script to build it</li>
<li>4=require manual corrections but the dataset is relatively big, or require a script to be fixed</li>
<li>5=require manual corrections but the dataset is really big</li>
<li>6=require manual corrections but the dataset is really big and require a personalized script to be built</li>
</ul>
<p>For example, <a href="https://htr-united.github.io/share.html?uri=507bb514d">"Notaires de Paris - Bronod"</a> had to be modified to comply with CATMuS requirements. This included replacing <code>[[</code> and <code>]]</code> <a href="https://catmus-guidelines.github.io/html/guidelines/en/corrections_and_others.html">with <code>⟦</code> and <code>⟧</code></a>, or also to ignore lines containing <code>¥</code>, a symbol used in LECTAUREP's datasets to transcribe signatures and paraphs. These were straightforward modifications, thanks to Chocomufin. On the complete opposite, <a href="https://htr-united.github.io/share.html?uri=7a99090c5">"University of Denver Collections as Data - HTR Train and Validation Set JCRS_2020_5_27"</a> is a massive dataset (2660 XML files), but there are segmentation errors in this dataset, creating erroneous transcriptions given the way the line is drawn, and the annotation of the superscripted text is not compatible with CATMuS. To make it compatible with CATMuS, it would be necessary to control and correct each page one by one.</p>
<p>I chose to focus on datasets with priority 2 for the <em>first</em> version of McCATMuS. Indeed, it'll be possible to add more datasets into CATMuS in later versions, so there was no need to spend too much time on manually cleaning datasets. I had 23 with priority 2 to go through.</p>
<p>Identifying eligible datasets was not as time consuming as cleaning them and collecting additional metadata turned out to be. However, it gave me a good idea of the challenges I would face when trying to aggregate the datasets. I would have liked to be able to find a greater diversity of languages, but this is wasn't possible at this stage, mainly because many non-French datasets require more elaborate corrections than applying Chocomufin and were thus given a priority score higher than 2. </p>
<p>The next post will be covering the tedious phase of data cleaning and aggregation, along with metadata collection!</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:images">
<p>It was the case in "<a href="https://htr-united.github.io/share.html?uri=c326a6fee">Données vérité de terrain HTR+ Annuaire des propriétaires et des propriétés de Paris et du département de la Seine (1898-1923)</a> where the ALTO XML files are not explicitly linked to their corresponding source images. I believe it can be fixed, but it would require creating a script just for this purpose and the dataset presented other incompatibilities with CATMuS' guidelines. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/020/#fnref:images" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:segmentation">
<p>For example, "<a href="https://htr-united.github.io/share.html?uri=43d1c93c7">Argus des Brevets</a>" contains some segmentation errors that will need to be corrected manually. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/020/#fnref:segmentation" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/019/" class="u-url">019 - McCATMuS #2 - Defining guidelines</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/019/" rel="bookmark">
            <time class="published dt-published" datetime="2024-08-20T00:00:00-04:00" itemprop="datePublished" title="2024-08-20">2024-08-20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><a href="https://x.com/JMFradeRue/status/1730191566508060883">Previous experiments</a> have shown that conflicting transcription guidelines in training datasets make it less likely that a model will learn to transcribe correctly. This is particularly relevant when it comes to abbreviations and it's something to keep in mind when merging existing datasets. We didn't really address this when we trained the <a href="https://inria.hal.science/hal-04094241">Manu McFrench model</a> because it's difficult to retroactively align datasets to follow the same transcription rules. Unless you can afford to manually check every line, of course. In the case of Manu McFrench however, we only merged datasets that didn't solve abbreviations, so we ensured a minimum of cohesion.</p>
<p>CATMuS was built on the foundation laid by CREMMALab and the <a href="https://hal.science/hal-03716526">annotation guidelines</a> developed by Ariane Pinche at the end of a seminar organized in 2021. These guidelines are intended to be generic, meaning they should be compatible with most transcription situations and are not project-specific. Following these guidelines will help data producers create ground truth that is compatible with data from other projects. It will also help those projects save time by not having to create transcription rules from scratch. From my experience, it is indeed easy for the members of a project discovering HTR to get caught up in the specifics of one project and forget what is and is not relevant (or even complicating) in the transcription phase.</p>
<blockquote>
<p><em>It's worth mentioning that a project can choose to follow some of the CATMuS guidelines, while maintaining more specific rules for certain cases. If that's the case, the CATMuS guidelines can (should?) be used as a reference point. Ideally, the specific rules defined by a project should be retro-compatible with CATMuS. For example, if a project decides to use a special character to mark the end of each paragraph, then in order to create a CATMuS-compatible version of the dataset, I should only have to replace or remove that character. In such cases, the special character that was chosen should be unambiguous and the rule should be explicitly presented.</em></p>
</blockquote>
<p>As CREMMALab focused on the transcription of medieval manuscripts, so did the first CATMuS dataset and guidelines. As I said in my <a href="https://alix-tz.github.io/phd/posts/018/">previous post</a>, I focused on data covering the modern and contemporary periods, for which there was no equivalent to the CREMMALab guidelines. So, when extending CATMuS to these periods, I started with collecting existing guidelines and comparing them. I used the <a href="https://hal.science/hal-03697382">CREMMA Medieval guidelines</a>, the <a href="https://gist.github.com/alix-tz/6f89444521bf1cab0522da520f7e4ff4">CREMMA guidelines for modern and contemporary documents</a>, <a href="https://hal.science/hal-04281804">SETAF's guidelines</a> and <a href="https://hal.science/hal-04557457">CATMuS Print's guidelines</a> as a basis to elaborate the transcription rules for McCATMuS.</p>
<p>For each rubric, I <a href="https://docs.google.com/spreadsheets/d/1bFE-rRk6ZwgIHqXAOgwPo1s1zwQ-UPTLPnzjaRmTMsk/edit?usp=sharing">compared</a> what each set of rules suggested, when they covered it. It was rare for all guidelines to align, but some cases were easy to solve. For example, all the guidelines recommended not to differentiate between regular s (<code>⟨s⟩</code>) and long s (<code>⟨ſ⟩</code>), except for the rules I had set for the modern and contemporary sources transcribed by CREMMA in 2021, before the CREMMALab seminar. It was thus decided that for McCATMuS there would be no distinction between all types of s's.</p>
<p>Some rubrics needed to be discussed to figure out why the rule had been chosen in the first place by some of the projects, to decide which one to keep for McCATMuS. In February, I met with Ariane Pinche and Simon Gabay to go over the rubrics that still needed to be set. One example of a rule we discussed is how hyphenations are handled. CATMuS Medieval and the two CREMMA guidelines say to always use the same symbol (<code>⟨-⟩</code>), whereas for the SETAF and CATMuS Print datasets, inline hyphenations (<code>⟨-⟩</code>) are differentiated from hyphenations at the end of a line (<code>⟨¬⟩</code>). Other symbols, like <code>⟨⸗⟩</code>, were unanimously rejected.</p>
<p>Two factors were considered when making those decisions: the feasibility of a retro-conversion for the existing datasets and the compatibility of the rule with a maximum of projects. In the case of hyphenations, I eventually decided to follow the same rule as CATMuS Medieval and CREMMA. On top of simplifying the compatibility of McCATMuS with CATMuS Medieval, I found that replacing all <code>⟨¬⟩</code> with <code>⟨-⟩</code>, rather than retroactively place <code>⟨¬⟩</code> where there was indeed an hyphenation at the end of a line<sup id="fnref:hyphen"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/019/#fn:hyphen">1</a></sup> was much more straightforward.</p>
<p>Once the set of rules was fixed, I used it to sort between the different datasets I had identified (I'll discuss this in the next post) and to decide which one would be retained for McCATMuS v1. I also defined the transformation scenarios necessary to turn each of these datasets into a CATMuS-compatible version. Then, once McCATMuS v1 was ready, I integrated the modern and contemporary guidelines into the <a href="https://catmus-guidelines.github.io/">CATMuS website</a>, where the transcription guidelines for CATMuS medieval were already published.</p>
<p>Now that I am done integrating the rules set for McCATMuS into the website, I am confident that we have successfully designed rules that are overall compatible across the medieval, modern and contemporary periods, despite some unavoidable exceptions. Two good examples of the impossibility to cover a whole millennium of document production with the same rule are the <a href="https://catmus-guidelines.github.io/html/guidelines/en/abbreviations.html">abbreviations</a> and the <a href="https://catmus-guidelines.github.io/html/guidelines/en/punctuation.html">punctuation signs</a>.</p>
<p>I've now explained how the transcription guidelines were established for McCATMuS. Next, I'll cover how they were integrated into existing datasets to create the first version of the McCATMuS dataset.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:hyphen">
<p>You can't assume that every instance of <code>⟨-⟩</code> at the end of a line must be replaced with a <code>⟨¬⟩</code>. In many cases, this can be a simple typographic decoration marking the end of a paragraph or the end of a title. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/019/#fnref:hyphen" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/018/" class="u-url">018 - McCATMuS #1 - Overview</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/018/" rel="bookmark">
            <time class="published dt-published" datetime="2024-08-14T00:00:00-04:00" itemprop="datePublished" title="2024-08-14">2024-08-14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Last week, I attended <a href="https://dh2024.adho.org/">ADHO's annual conference</a> in Washington DC. I presented a short paper, co-authored with Floriane Chiffoleau and Hugo Scheithauer, about the documentation we wrote for eScriptorium (I wrote <a href="https://alix-tz.github.io/phd/posts/018/010">a post</a> about it last year and you can also find our presentation <a href="https://inria.hal.science/hal-04594142">here</a>). I was also a co-author on a long paper presented by Ariane Pinche on the <a href="https://inria.hal.science/hal-04346939">CATMuS Medieval dataset</a>.</p>
<p>CATMuS, which stands for "Consistent Approach to Transcribing ManuScripts", is a collective initiative and a framework to aggregate ground truth datasets using compatible <a href="https://catmus-guidelines.github.io/">transcription guidelines</a> for documents from different period written in romance languages. It started with <a href="https://huggingface.co/datasets/CATMuS/medieval">CATMuS Medieval</a>, but since January this year, I have been working on a version of CATMuS for the modern and contemporary period. </p>
<p>While I should (and will) try to publish a data paper on CATMuS Modern &amp; Contemporary (I'll call it McCatmus from now on), I figured I could start with a series of blog posts here. I want to describe the various steps I followed in order to eventually release <a href="https://huggingface.co/datasets/CATMuS/modern">a dataset on HuggingFace</a> and hopefully soon the corresponding transcription model.</p>
<p>I started working on McCatmus in January, but because of a major personal event (I moved to Canada!), it took seven month of stop-and-go before the release of the V1. This was particularly challenging due to the scale of the project and its technicality (it was hard to get back into McCatmus after several weeks of interruption, which I had to do several times).</p>
<p>To add to this complexity, McCatmus was also a multi-front operation. Indeed, to create McCatmus, it was necessary to:</p>
<ul>
<li>define transcription guidelines in collaboration with other data producers,</li>
<li>identify datasets compatible with the guidelines and set priorities,</li>
<li>actually make all the dataset compatible with each other and clean some of the data,</li>
<li>model and collect metadata that made sense for this dataset,</li>
<li>release the dataset and fix the issues that came up.</li>
</ul>
<p>To this date, two tasks remain on my to-do list for McCatmus: train a transcription model corresponding to this dataset and compare it with other existing ones, and make sure to have a publication describing this dataset and its usefulness.</p>
<p>My plan is to dedicate one post to the creation of the guidelines for the dataset, then a post about the identification and collection of the datasets used in McCatmus v1, and then I'll wrap up with a post about the process to create the dataset, the metadata and the release. Stay tuned!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/017/" class="u-url">017 - Deploying eScriptorium online: notes on CREMMA's server specifications</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague-and-thibault-clerice/">Alix Chagué and Thibault Clérice</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/017/" rel="bookmark">
            <time class="published dt-published" datetime="2023-12-22T08:43:54-05:00" itemprop="datePublished" title="2023-12-22">2023-12-22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><a href="https://gitlab.com/scripta/escriptorium/">eScriptorium</a> is a web application designed to perform automatic text recognition campaigns, by default powered by the OCR/HTR engine <a href="https://kraken.re/">Kraken</a>. It comes in a decentralized form, meaning that the application is not distributed by a single organization but can, on the contrary, be deployed by several actors on many different servers. In fact, you can also deploy eScriptorium <a href="https://gitlab.com/scripta/escriptorium/-/wikis/docker-install">on your personal machine</a>, simulating a local server.<sup id="fnref:localhost"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:localhost">1</a></sup></p>
<p>As eScriptorium is gaining attention, more institutions are interested in building their own server to host the application and offer it to their associates. At Inria, we deployed eScriptorium for the first time in 2020, specifically for the project called <a href="https://lectaurep.hypotheses.org/">LECTAUREP</a> which we ran with the <a href="https://www.archives-nationales.culture.gouv.fr/">French national archives</a> between 2018 and 2021. While the initial server was hosted on a virtual machine, without any GPU, and open to a relatively small amount of users, our current eScriptorium application already counts nearly 500 users and will soon be hosted on a much different server infrastructure, funded by the <a href="https://www.pamir.fr/projets-soutenus/cremma/">CREMMA project</a>. Between the original LECTAUREP-eScriptorium server and the CREMMA server, we moved to a dedicated server (<code>Traces-6</code>) for which we invested about 20K€.</p>
<p>Since I have been regularly in touch with people from different institutions who were looking into buying the hardware to create their own server for eScriptorium, I thought it was largely time to put all the deets in writing!</p>
<p>To write today's post, I'm very happy to welcome a second pair of hands: Thibault Clérice's. His expertise and involvement in designing CREMMA server are crucial here!</p>
<p>Let's first discuss some technical requirements, then we'll describe how the CREMMA server was designed. We finish with some very important remarks on the necessity (or not) to build a server and on useful alternatives for the community!</p>
<h3>Should you buy GPUs?</h3>
<p><a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPUs</a> (or Graphics Processing Units) are not mandatory at all when you use eScriptorium. This is the reason why it is perfectly acceptable to run eScriptorium locally, on your own computer. Actually GPUs are not even mandatory to train Kraken models: training can be done on CPUs (your computer's processor), they will simply go much much much slower.</p>
<p>That, however, is true for personal or light use of the training features. If on the contrary you create a server open to dozens of users or more, then connecting eScriptorium to GPUs is very much a good idea: since training a model on a CPU alone can take 2-3 days (or much more), you don't really want 10 users to start a training task at the same time. In the absence of shared GPUs, their training will be queued for days or even weeks and the overload might degrade the experience of other users on the rest of the application. As long as we are building an infrastructure (and hopefully sharing costs), we may as well enhance the experience of everyone, no?</p>
<p>This being said, you shouldn't rush and go buy a GPU right away. Instead, you should first look at options to <em>optimize</em> its usage or at infrastructures that are already available to you. For example, the <a href="https://www.unige.ch/lettres/humanites-numeriques/recherche/projets-de-la-chaire/fondue">FONDuE infrastructure</a>, at the University of Geneva, doesn't use the GPUs only for eScriptorium: they connect their application to a cluster which is used by researchers for intense computation tasks outside of eScriptorium (it's an <a href="https://en.wikipedia.org/wiki/High-performance_computing">HPC</a> with a university-wide queue controlled by <a href="https://en.wikipedia.org/wiki/Slurm_Workload_Manager">SLURM</a>). This is a very good solution for optimization, because training Kraken models is not a constant activity: if the GPU is dedicated to eScriptorium only, then it will be used for a few hours here and there, not even at 100% of its capacity. Think of it: users of the application will usually need to train a model at the beginning of their transcription campaign, therefore once they have an <a href="https://alix-tz.github.io/phd/posts/12/">accurate model</a>, they will focus on using the model for prediction, which doesn't rely on the GPUs (and Kraken isn't really optimized for GPU usage at prediction time anyway).</p>
<p>Other possibilities include connecting the server to a completely physically separate cluster where training jobs are submitted. This is a possibility that several people told me they were exploring, but I don't know if anyone has set it already. Why would you opt for a solution with an external cluster? To replace some huge investment costs (original funding) with some smaller (but much more regular) functioning costs: for example, for CREMMA, nearly half of our 40K€ budget was spent, in 2022, on buying two <a href="https://www.nvidia.com/fr-fr/data-center/a100/">A100 graphic cards from Nvidia</a>. When using someone else's GPUs, not only you save the money you would spend on the hardware, but on top of that, you contribute to optimizing the use of other GPUs already in place. Another reason is because you might not have the human resources to administer the system and the GPUs. There are multiple calculation clusters created for Academia (of the top of our head: <a href="https://www.cnrs.fr/fr/presse/jean-zay-le-supercalculateur-le-plus-puissant-de-france-pour-la-recherche">Jean Zay</a> or <a href="https://www.calculquebec.ca/services-aux-chercheurs/infrastructures-et-services/">Calcul Québec</a>), and you could even consider using commercial solutions as well (like <a href="https://aws.amazon.com/nvidia/">AWS</a>, <a href="https://cloud.google.com/gpu?hl=fr">Google Cloud</a> and the like). Then, your money is spent on the actual computation and not on making the computation possible in the first place.</p>
<p>Fair enough, plugging eScriptorium's task manager to an external server might not be that simple. However, for smaller groups of users, it is also worth taking into account that it is perfectly possible to train Kraken models using Kraken directly (through an SSH connection to a (super-)cluster, for example) before uploading them into the application. In such a case, eScriptorium is only used for its ergonomics, not as a simplified interface to train models.</p>
<p>Let's summarize the point here: GPUs are not always a must-have for eScriptorium or Kraken, so you should definitely consider first and foremost your future usage. They currently represent the biggest share in the hardware expenses to build a calculation server. There are options out there where you don't spend 10K€ to buy a GPU but rather connect to an external, ready-to-use service. Or, if you do decide to spend the money, you should consider ways to maximize its usage for other training tasks, possibly outside of eScriptorium.</p>
<h3>Some considerations on storage</h3>
<p>Normally, eScriptorium is used as an (assisted) annotation environment to obtain the transcription of documents. You would use eScriptorium:</p>
<ol>
<li>In a preparatory phase:<ul>
<li>(1a) to produce training data, and</li>
<li>(1b) to elaborate (aka train) performant segmentation or transcription models;</li>
</ul>
</li>
<li>In a production phase, but only for relatively small corpora, to apply segmentation and transcription models and manually correct the results (in which case the size of the corpora must be compatible with the scale of what an individual or your assembled team can process);</li>
<li>In a post-production phase, including for samples of a very large corpus, to easily visualize and control the result of the (large-scale) automatic prediction and potentially correct it (cf. n°2).</li>
</ol>
<p>On the other hand, large scale transcription campaigns should probably be led with Kraken in the command line directly (so only n°1 and n°3 necessitate eScriptorium). Thibault has even produced a small python library to design such campaigns (<a href="https://github.com/ponteIneptique/rtk">RTK</a>, for Release the Krakens) which was recently used in <a href="https://enc.hal.science/hal-04250657/">a paper</a><sup id="fnref:lovewarref"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:lovewarref">2</a></sup> where a 38.5M token corpus was produced. In some cases, n°1b even benefits from being performed outside of eScriptorium, since the application offers a very limited control over <a href="https://kraken.re/main/ketos.html#recognition-training">Kraken's training parameters</a>.</p>
<p>This has several consequences on the way you should consider storage on a server dedicated to eScriptorium. Duplicates of images are created on the server while they are being processed in the application, but they should always be considered as such: temporary duplicates while phase 1, 2 or 3 are under progress. They shouldn't be considered as if eScriptorium was 1) an archiving solution for transcription projects, 2) a querying interface to explore a corpus or even 3) a publication environment for a minimalistic digital edition. eScriptorium is only one brick --an early one even-- in the corresponding pipelines. Instead, the original image files should be stored somewhere else, in an adapted data warehouse (like <a href="https://zenodo.org/">Zenodo</a>, <a href="https://www.nakala.fr/">Nakala</a>, etc.), or published in digital libraries under the responsibility of their owner (like <a href="https://archive.org/">Internet Archive</a>, <a href="https://gallica.bnf.fr/">Gallica</a>, etc.).</p>
<p>What this means when designing a server to host eScriptorium is that its storage capacity should of course be big enough to store the temporary image files,<sup id="fnref:temporary"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:temporary">3</a></sup> while users are working on their annotation, aka the active projects. However, this storage doesn't need to be expended all the time and it should also be ok to flush the terminated projects: at that point the images and their annotations should have been archived on more appropriate data warehouses by their creators, and it should be their responsibility.</p>
<h3>Don't forget the RAM!</h3>
<p>Not overlooking the <a href="https://en.wikipedia.org/wiki/Random-access_memory">RAM</a> is very important when designing your server! But what is it used for? It's used for cache by the web application: it means that frequently accessed data, like web pages and images but also the content of the database, are temporarily loaded in live memory. Cache thus ensures that the requests sent by the users are served quickly. For example, if you don't have enough RAM (or enough cache), pages will load slowly, and if you have used eScriptorium before reading this post, you know how important it is to be able to load images fast enough.</p>
<p>RAM is also essential for inference and training because images and annotations are loaded in memory before being passed to the CPU or the GPU. If the RAM is not powerful enough, it will be detrimental to computation and will cause a bottleneck situation. Thus having invested in GPUs and/or CPUs but not in enough RAM would be like having a horse to pull a Ferrari: even if prediction and training could go fast on the processing units, it will be restrained by the available live memory.</p>
<h3>Modularity for the CREMMA infrastructure</h3>
<p>The CREMMA infrastructure was originally designed by Thibault with a simple but essential principle in mind: modularity. Instead of thinking of an eScriptorium server as a monolithic block of hardware designed for front-end service, storage and intense computation, he suggested to break each of these blocks into individual servers connected together. CREMMA<sup id="fnref:cremma"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:cremma">4</a></sup> is thus made of at least three servers, as shown in the schema below:</p>
<ul>
<li>
<code>CREMMA_FRONTEND</code>, for the front-end, where the application is deployed and where the database is stored.</li>
<li>
<code>CREMMA_STORAGE</code>, for storage, where all the images and models, as well as the backup of the database are stored on the long term. Currently, <code>CREMMA_STORAGE</code> has a storage capacity of 38Tb<sup id="fnref:storage"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:storage">5</a></sup> but we could easily add more disks if we find that it is necessary. </li>
<li>
<code>CREMMA_COMPUTE</code>, where the two A100 GPUs I mentioned earlier are plugged and where the application task manager "sends" all the jobs, whether they are to be run on CPU (these tasks include segmentation and transcription prediction for example), or on GPU (training for the most part).</li>
</ul>
<p><img src="https://alix-tz.github.io/phd/images/CREMMA_server_specs.png" alt="A model of the CREMMA infrastructure where three blocks (front-end, storage and compute) are connected together through an intranet 10Gb/s connection. For each block, one or two server(s) is presented along with their specification. Credits: Thibault Clérice and Alix Chagué. The full text of the specifications is accessible in a commentary in the source code of this page, just after this image." widht="400px"></p>
<!-- 
Full text of the specifications displayed on the image, for accessibility purposes:

- CREMMA_FRONTEND: 2xEPYC 7302 16C/32T; 128 Gb RAM; 1.6 To; RAID with 8Gb Cache.
- CREMMA_STORAGE: Optimized for cache; 256 Gb RAM; 2xRaidZ 19Tb; NVME for ZFS / L2ARC; SSD for OS.
- CREMMA_COMPUTE: 2xAMD EPYC 7302 16C/32T; 128 Gb RAM; 2xRTX A6000 24Gb.
- TRACES-6: 2xEPYC 7452 32C/64T; 512 Gb RAM; 0.8 Tb RAID with 8Gb Cache; 2xA100 40 Gb.
-->

<p>As you can see on the schema, there will actually be a fourth server involved in the infrastructure: <code>Traces-6</code>, the server we currently use <a href="https://escriptorium.inria.fr/">to deploy eScriptorium at Inria</a>. Like <code>CREMMA_COMPUTE</code>, <code>Traces-6</code> can be called by <code>CREMMA_FRONTEND</code> for computation tasks. In fact, this is where the modularity of the system is interesting: with such a set-up, it is possible to add more computation servers to the pool of GPUs reachable by <code>CREMMA_FRONTEND</code> without having to redesign the whole infrastructure. On their side, <code>CREMMA_FRONTEND</code> and <code>CREMMA_STORAGE</code> can be upgraded (to add more RAM or more storage) very easily.</p>
<p>This modularity also means that the GPUs remain free for other uses: for example if we were to have to run maintenances on <code>CREMMA_COMPUTE</code>, we can simply cut it from the infrastructure, and let <code>CREMMA_FRONTEND</code> interact with <code>Traces-6</code> only while we work on <code>CREMMA_COMPUTE</code>.</p>
<p><code>CREMMA_COMPUTE</code> is equipped with two <a href="https://www.nvidia.com/fr-fr/data-center/a100/">A100</a> graphic cards, and <code>Traces-6</code> with two <a href="https://www.nvidia.com/fr-fr/design-visualization/rtx-6000/">RTX 6000</a>. Actually, it doesn't mean that only 4 training can be happening at once. Each of these GPUs offer between 24 and 40 Gb of RAM for intense computation. It's a lot. It's so much actually that training a Kraken model at max speed would rarely use more than 40% of this processing power. <a href="https://www.nvidia.com/en-us/data-center/virtual-solutions/">Virtualization</a> is a nice trick to "break" the GPU down into smaller virtual GPUs (or vGPUs). What is broken down is the RAM capacity. We opted for the following virtualization set up:</p>
<ul>
<li>Each of the A100 graphic cards and their 40Gb of RAM are turned into 1 10Gb vGPU + 5 5Gb vGPUs (since 10+5x5=35, note that we must leave 5Gb out of the equation for the virtualization).</li>
<li>No virtualization is applied to Traces-6's RTX6000s.</li>
</ul>
<p>How did we decide on these numbers? Thibault ran a series of small tests executing either <a href="https://kraken.re/main/ketos.html#segmentation-training"><code>segtrain</code></a> or <a href="https://kraken.re/main/ketos.html#recognition-training"><code>train</code></a> and playing with two different parameters: the <a href="https://github.com/mittagessen/kraken/blob/992fb0bc915e689fc76fa6b021e364c3f0f17ca3/kraken/ketos/recognition.py#L38">batch size</a><sup id="fnref:batch_size"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:batch_size">6</a></sup> and the <a href="https://github.com/mittagessen/kraken/blob/992fb0bc915e689fc76fa6b021e364c3f0f17ca3/kraken/ketos/recognition.py#L79">single point precision</a><sup id="fnref:precision"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:precision">7</a></sup>. He found that for training a recognition model with a batch size of 8 and either 32 or 16 of precision, less than 5 Gb of RAM on the GPU is enough. With a batch size of 1 and a precision of 32, it's even less than 1 Gb. To train a segmentation model, less than 10Gb is enough, and this type of training is more rare. Since our goal for the infrastructure is not to maximize the speed of the training but to maximize the amount of possible parallel training jobs at decent speed, we decided that 10 vGPUs with 5Gb of RAM and 2 vGPUs with 10Gb of RAM were a good compromise. If we find that more GPU RAM is occasionally needed, we still have two times 24Gb with the RTX6000!</p>
<h3>Should you build your own server?</h3>
<p>We have spent all this time writing about how to build, how to spec out your server or your infrastructure, but let's talk about the elephant in the room: should you do it?</p>
<p>Well, it's all a matter of perspectives. We'd say it probably makes sense if:</p>
<ol>
<li>You are a very big organization, you have a lot of money available to you, a super-cluster (and possibly a well staffed IT services department), and you have a high demand;</li>
<li>You are working on very sensitive data that can't be shared with the outside (<em>e.g.</em> medical reports);</li>
<li>You are geographically far away from any other existing server, and face latency issues when you connect to potential welcoming servers;</li>
<li>Servers that exist around you are reluctant to onboard you and the teams behind the request for a server of your own.</li>
</ol>
<p>These four points are definitely valid. But we'd say that, if you are in another situation, sharing infrastructural costs probably makes way more sense. In our experience, building a server is long, tedious, require special (and rare) skills<sup id="fnref:sysadmin"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/017/#fn:sysadmin">8</a></sup> and costly (in terms of human resources as well!). Setting up a working server can take a really long time. For CREMMA, we ended up outsourcing part of the installation of the new infrastructure because we realized that we did not have the time nor the skills to set everything up ourselves. The cost of this installation by a third-party? Between 8 and 12K€, and again, a little time and bandwidth on our end.</p>
<p>Next you have the maintenance fees. You can outsource them, for a little bill from a company which would make sure that everything is installed on time, that updates work well, etc. Or you can do the maintenance yourself. But again, this comes with a cost: human time. A worker on the server goes down? You are in for a few hours. Some people crashed a third-party server by uploading too much IIIF images on your instance of eScriptorium? Well, then you will not only receive emails from these third parties (and this is completely normal), but also have to deal with your user base doing things that eScriptorium allows and that you may not (yet) be able to control/limit.</p>
<p>In the end, we would definitely recommend that, when this is possible, you first consider joining existing servers, including by offering <em>quid pro quo</em> by:</p>
<ol>
<li>Participating in covering the salary of people maintaining the server (through some kind of yearly fees for example);</li>
<li>Providing some money to expand the existing infrastructure (to increase storage or computation, etc);</li>
<li>In general, helping eScriptorium grow, discussing with the owners of the server you are joining and/or the eScriptorium team about what kind of new functionality should be added, and if you can contribute to fund these updates.</li>
</ol>
<p>This final point is super important: sure, owning your own server sounds appealing, even if it is costly to put in place. However, developing eScriptorium also comes with expenses. Thus, participating in eScriptorium directly -- we think -- is also very beneficial and welcome by the developing team. Open-source is free to use, free of charge but is not appearing out of thin air: developing costs money. And the more people participate in infrastructural costs (servers or software), the better the experience will be.</p>
<!-- footnotes -->

<div class="footnote">
<hr>
<ol>
<li id="fn:localhost">
<p>If you don't know anything about local servers and are curious to learn more, you can check this page: <a href="https://www.freecodecamp.org/news/what-is-localhost/">https://www.freecodecamp.org/news/what-is-localhost/</a>. Or you can also take a look at the corresponding <a href="https://en.wikipedia.org/wiki/Localhost">entry</a> in Wikipedia! <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:localhost" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:lovewarref">
<p>The full reference is: Jean-Baptiste Camps, Nicolas Baumard, Pierre-Carl Langlais, Olivier Morin, Thibault Clérice, et al.. Make Love or War? Monitoring the Thematic Evolution of Medieval French Narratives. Computational Humanities Research (CHR 2023), Dec 2023, Paris, France. ⟨hal-04250657⟩ <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:lovewarref" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:temporary">
<p>By temporary, we don't mean that the image file are stored for a few hours only, on the contrary, they can stay on the disk for many years. We mean that it should be ok to consider that they can be erased whenever a user is done working on a corpus and has moved away from the transcription phase. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:temporary" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:cremma">
<p>From now on, "CREMMA" means the server created through the CREMMA project. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:cremma" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn:storage">
<p>Safety first! We have 38 Tb available, but there is actually a little more  physically because we have redundancy and spare. We have 2 series of disks working with redundancy (<a href="https://openzfs.github.io/openzfs-docs/Basic%20Concepts/RAIDZ.html">RaidZ</a>). In each series two disks are entirely dedicated to redundancy only, and one more is completely unused until something fails (it is used as a safety spare disk). While <code>CREMMA_STORAGE</code>, as we said before, is not used as a permanent storage solution, it needs to be a little bit safe for the user base. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:storage" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
<li id="fn:batch_size">
<p>To understand what the batch size corresponds to and why it is important, you can check this entry in the Stack Exchange forum: <a href="https://stats.stackexchange.com/questions/153531/what-is-batch-size-in-neural-network">https://stats.stackexchange.com/questions/153531/what-is-batch-size-in-neural-network</a>. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:batch_size" title="Jump back to footnote 6 in the text">↩</a></p>
</li>
<li id="fn:precision">
<p>To quote <a href="https://kraken.re/main/ketos.html#recognition-model-training">Kraken's documentation</a>: "When using an Nvidia GPU, set the --precision option to 16 to use automatic mixed precision (AMP). This can provide significant speedup without any loss in accuracy." Kraken's default value for precision is 32. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:precision" title="Jump back to footnote 7 in the text">↩</a></p>
</li>
<li id="fn:sysadmin">
<p>It can be difficult to justify hiring a full-time or even part-time system administrator for a team because it is a very specialized and highly demanded type of profile. For example, public organizations can rarely offer competitive salaries compared to the private sector. In addition, the workload for administrating a web server can be irregular, and it can be difficult to make the skills for system administration meet with other needs faced by a team, complicating even more offering a meaningful full-time job. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/017/#fnref:sysadmin" title="Jump back to footnote 8 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="https://alix-tz.github.io/phd/posts/016/" class="u-url">016 - Text Recognition, Large Models and Expectations</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="https://alix-tz.github.io/phd/authors/alix-chague/">Alix Chagué</a>
            </span></p>
            <p class="dateline">
            <a href="https://alix-tz.github.io/phd/posts/016/" rel="bookmark">
            <time class="published dt-published" datetime="2023-11-28T05:28:15-05:00" itemprop="datePublished" title="2023-11-28">2023-11-28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Since the boom around ChatGPT almost a year ago, I've heard several people wondering if "tools like ChatGPT" were more efficient than HTR models trained with <a href="https://kraken.re">Kraken</a> and the like. The glimmer of hope in their eyes was most likely lit by their own struggle to set successful and/or efficient HTR campaigns with more traditional tools. The capacity of Large Language Models (LLMs) to reformulate a text<sup id="fnref:spina"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/016/#fn:spina">1</a></sup> or, more specifically, of Large Multimodal Models (LMMs) to generate text based on a visual input may indeed lead people to believe that HTR technologies built on <a href="https://poloclub.github.io/cnn-explainer/">CNNs</a> are on the verge of being flipped upside-down.<sup id="fnref:multimodal_turn"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/016/#fn:multimodal_turn">2</a></sup></p>
<p>Annika Rockenberger recently conducted a series of small experiments on the matter and wrote <a href="https://greflinger.hypotheses.org/739">an interesting blog post</a> about it. Let's summarize it!</p>
<p>She signed up for a premium subscription (25$/mo) to be able to chat with <a href="https://openai.com/gpt-4">GPT4</a>, which allows users to upload images. Then she submitted printed or handwritten documents she would normally transcribe with <a href="https://readcoop.eu/transkribus">Transkribus</a> and assessed the results. She found that GPT4 was fairly good on ancient print (German Fraktur) and that it was even able to follow transcription guidelines if provided with an example. However on a letter bearing handwritten cursive, the model completely hallucinated the content and attempted a transcription in the wrong language. This didn't change when she provided more context on the document. Rockenberger concludes that there is a potential for using ChatGPT for HTR but that the capacity of scaling it up is completely unsure and that learning how to provide good prompts to get the appropriate results is a challenge. I would also add that in the end, Rockenberger paid 25$ to get 10 lines of raw text, whereas with software like Transkribus or eScriptorium, she would also get a standard structured output.</p>
<p>So, in other words, after reading Rockenberger's post, one can conclude that GPT4 (or, better, similar free and open source models) does have a potential for "quick and dirty-ish" OCR. However, I would argue that users tempted by this strategy might still miss an important point: even LMM-based tools will requires a little bit of organization and precision from the users. This, I find, often lacks in unsuccessful HTR campaigns. LMMs could generate a good output, but you will likely have to pay a counterpart one way or the other(s): with lower text recognition quality, with hallucinated text content, with impoverished non-structured output, with premium fees, etc.</p>
<p>Earlier this year, an article proposed by <a href="https://arxiv.org/abs/2305.07895">Liu et al. (2023)</a>, "On the Hidden Mystery of OCR in Large Multimodal Models", explored almost exactly the same topic but in a more comprehensive way. Their article presents an extensive survey of how well several Large <a href="https://en.wikipedia.org/wiki/Multimodal_learning">Multimodal</a> Models (LMMs) performed on "zero-shot" tasks.</p>
<p>Zero-shot refers to the act of requesting an output from an LLM or a LMM without training it for this task in particular. It is very similar to Rockenberger's first attempt with GPT4, when she uploaded the image of a printed document and asked for its transcription. In such a case, she relied on the capacity of the model to transfer its knowledge to the specific tasks of Text Recognition, on a specific type of documents (historical printed text).</p>
<p>Other terms are often associated with "zero-shot:" "one-shot" and "few-shot". One-shot is equivalent to Rockenberger's second attempt: when she showed GPT4 an example of the output she expected on the 10 first lines of the documents, and requested that the model copied her strategy to generate the transcription of the 10 next lines. Few-shot would mean showing several pages and several expected output to the model before asking for the transcription of a new document.<sup id="fnref:shot-definition"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/016/#fn:shot-definition">3</a></sup></p>
<p>The paper focused on currently available LMMs representing five different approaches for training LMMs:</p>
<ul>
<li>
<a href="https://huggingface.co/docs/transformers/model_doc/blip-2">BLIP-2</a>,</li>
<li>
<a href="https://arxiv.org/abs/2204.14198">Flamingo</a>/<a href="https://laion.ai/blog/open-flamingo/">Open-Flamingo</a>,</li>
<li>
<a href="https://llava-vl.github.io/">LLaVa</a>,</li>
<li>
<a href="https://minigpt-4.github.io/">miniGPT4</a>, and</li>
<li>
<a href="https://huggingface.co/spaces/MAGAer13/mPLUG-Owl">mPLUG-Owl</a>.</li>
</ul>
<p>They evaluated the models on 4 tasks: text recognition, text-based visual question answering, key information extraction and handwritten mathematical expression recognition. Here are a few examples of what these tasks entail, as illustrated in the original article (on the images, P stands for Prediction and GT for Ground Truth):</p>
<table>
<thead><tr>
<th style="text-align: left;">Task</th>
<th style="text-align: center;">Example</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: left;">Text Recognition</td>
<td style="text-align: center;"><img alt="Examples of failed Text Recognition" src="https://alix-tz.github.io/phd/images/LLM_text_recogntion.png" title="Four images contained printed of handwritten words along with the ground truth (expected transcription) and the prediction generated by the models. For example, the model predicted 'chocolate' when the expected transcription was 'choco'"></td>
</tr>
<tr>
<td style="text-align: left;">Visual Question Answering</td>
<td style="text-align: center;"><img alt="Examples of failed Visual Question Answering" src="https://alix-tz.github.io/phd/images/LLM_textVQA.png" title="Two images of real-life views along with a question used as a prompt, the expected answer and the predicted answer. For example, when asked 'What is the yellow number?' on the image of an airport luggage retrieval conveyor belt showing a clear '7' in yellow in the background, the model provided the following answer: 'The yellow number on the luggage trolley is 32"></td>
</tr>
<tr>
<td style="text-align: left;">*Key Information Extraction</td>
<td style="text-align: center;"><img alt="Examples of failed Key Information Extraction" src="https://alix-tz.github.io/phd/images/LLM_keyinfoextraction.png" title="Three images of real-life documents or textual information, along side with a question used as a prompt for the model, the expected answer and the predicted answer. For example, when asked 'what is the Sample No information in the input?', the model is expected to answer '1194-90' but answers 'The sample number is 33340'"></td>
</tr>
<tr>
<td style="text-align: left;">Handwritten Mathematical Expression Recognition</td>
<td style="text-align: center;"><img alt="Examples of failed Handwritten Mathematical Expression Recognition" src="https://alix-tz.github.io/phd/images/LLM_HMExpr.png" title="Four example of failed attempts from the LMM to predict a LaTeX representation of handwritten mathematical expression: the numbers are wrong and/or the mathematical structure of the equations is made up"></td>
</tr>
</tbody>
</table>
<!-- "Four images contained printed of handwritten words along with the ground truth (expected transcription) and the prediction generated by the models. For example, the model predicted 'chocolate' when the expected transcription was 'choco'.") | --><!--  "Two images of real-life views along with a question used as a prompt, the expected answer and the predicted answer. For example, when asked 'What is the yellow number?' on the image of an airport luggage retrieval conveyor belt showing a clear '7' in yellow in the background, the model provided the following answer: 'The yellow number on the luggage trolley is 32") | --><!--  "Three images of real-life documents or textual information, along side with a question used as a prompt for the model, the expected answer and the predicted answer. For example, when asked 'what is the Sample No information in the input?', the model is expected to answer '1194-90' but answers 'The sample number is 33340'") | --><!--  "Four example of failed attempts from the LMM to predict a LaTeX representation of handwritten mathematical expression: the numbers are wrong and/or the mathematical structure of the equations is made up") | --><p>For each task, they used several datasets presenting different challenges. For each of these datasets and tasks, they retrieved the scores of the state-of-the-art (sota) for supervised methods and used them as a baseline. For example, for text recognition on the <a href="https://fki.tic.heia-fr.ch/databases/iam-handwriting-database">IAM dataset</a>, the sota method of AttentionHTR<sup id="fnref:attentionhtr_ref"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/016/#fn:attentionhtr_ref">4</a></sup> reaches a word accuracy of 91.24%.<sup id="fnref:remark_wer"><a class="footnote-ref" href="https://alix-tz.github.io/phd/posts/016/#fn:remark_wer">5</a></sup> In comparison, Liu et al provide the following scores for the tested LMM on this dataset:</p>
<table>
<thead><tr>
<th style="text-align: left;">test LMM</th>
<th style="text-align: center;">Score on IAM</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align: left;">BLIP-2 OPT<sub>6.7b</sub>
</td>
<td style="text-align: center;">38.00</td>
</tr>
<tr>
<td style="text-align: left;">BLIP-2 FlanT5<sub>XXL</sub>
</td>
<td style="text-align: center;">40.50</td>
</tr>
<tr>
<td style="text-align: left;">OpenFlamingo</td>
<td style="text-align: center;">45.53</td>
</tr>
<tr>
<td style="text-align: left;">LLaVa</td>
<td style="text-align: center;"><em>50.40</em></td>
</tr>
<tr>
<td style="text-align: left;">MiniGPT4</td>
<td style="text-align: center;">28.90</td>
</tr>
<tr>
<td style="text-align: left;">mPLUG-Owl</td>
<td style="text-align: center;">42.53</td>
</tr>
<tr>
<td style="text-align: left;">---------------</td>
<td style="text-align: center;">-----</td>
</tr>
<tr>
<td style="text-align: left;">Supervised SOTA</td>
<td style="text-align: center;"><strong>91.24</strong></td>
</tr>
</tbody>
</table>
<p>The illustrations provided by the article are all of failed attempts, but it corresponds to the overall impression conveyed by the results of the experiments. Indeed, compared to the state-of-the-art supervised methods, zero-shot tasks prompted to LMMs yield results largely outperformed, similar to what is visible in the case of text recognition on the IAM dataset. The only exception is BLIP-2 on a Text Recognition task on a dataset of artistic text (<a href="https://github.com/xdxie/WordArt#wordart-dataset">WordArt</a>) which is more challenging. The authors consider that this is a sign that LMMs have a promising potential for visually complex texts.</p>
<p>A very important section of their paper is their remarks on the relationship between LMMs and semantics. Submitting non-word images to the LMMs, they find that the LMMs systematically over-correct the prediction and suggest real-words as an answer. Traditional text recognition approaches, on the other hand, are much less sensitive to the notion of likelihood for the words to recognize. Similarly, the need for semantics interferes with the LMMs' output, and they tend to more easily recognize common words and make up additional letters ("choco" is read as "chocolate"). Lastly, LMMs are insensitive to word length: they are unable to count how many letters are in the image of a word. These results are similar to what Rockenberger experienced with the handwritten letter: the model hallucinated words to compose a semantically plausible letter. But using the wrong date, the wrong names, and the wrong language.</p>
<p>Liu et al conclude their paper reminding us that they experimented with the capacities of the models in the context of zero-shot prompts, whereas there are already successful attempts at fine-tuning LLMs and LMMs on specialized tasks, such as medical prediction. In fact, I think there already exist such attempts in the context of HTR as well: it seems to be the ambition of a model like Transkribus' Text Titan, released at the beginning of the Summer. It is based on a <a href="https://youtu.be/zxQyTK8quyY?feature=shared">Transformer</a> coupled with an LLM. Unfortunately, I wasn't able to find more information on this model, aside from the community-oriented communications released by Transkribus on their website (<a href="https://readcoop.eu/introducing-transkribus-super-models-get-access-to-the-text-titan-i/">here</a> and <a href="https://help.transkribus.org/super-models">here</a>).</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:spina">
<p>In stead of a multimodal approach, Salvatore Spina explored the possibility to use a LLM-based tool like ChatGPT3 to post-process the result of HTR and correct the text. See: Spina, S. (2023). <em>Artificial Intelligence in archival and historical scholarship workflow: HTS and ChatGPT</em> (arXiv:2308.02044). arXiv. <a href="https://doi.org/10.48550/arXiv.2308.02044">arXiv.2308.02044</a>. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/016/#fnref:spina" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:multimodal_turn">
<p>Multimodality is presented by some researchers of the Digital Humanities community as a real epistemological turn for the field. See for example: Smits, T., &amp; Wevers, M. (2023). <em>A multimodal turn in Digital Humanities. Using contrastive machine learning models to explore, enrich, and analyze digital visual historical collections</em>. Digital Scholarship in the Humanities, fqad008. <a href="https://doi.org/10.1093/llc/fqad008">doi: 10.1093/llc/fqad008</a> ; or Impett, L., &amp; Offert, F. (2023). <em>There Is a Digital Art History</em> (arXiv:2308.07464). arXiv. <a href="https://doi.org/10.48550/arXiv.2308.07464">arXiv.2308.07464</a>. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/016/#fnref:multimodal_turn" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:shot-definition">
<p>There are a few videos offering more or less detailed explanations on these expressions <a href="https://www.youtube.com/watch?v=E6X1Ufhxtf0">in the context of prompting an LLM</a>. However, this is not specific to LLM, it is often used in the context of <a href="https://huggingface.co/tasks/zero-shot-classification">classification</a> or <a href="https://joeddav.github.io/blog/2020/05/29/ZSL.html">NLP</a> tasks for example. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/016/#fnref:shot-definition" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:attentionhtr_ref">
<p>Kass, D., &amp; Vats, E. (2022). <em>AttentionHTR: Handwritten Text Recognition Based on Attention Encoder-Decoder Networks</em> (arXiv:2201.09390). arXiv. <a href="https://doi.org/10.48550/arXiv.2201.09390">arXiv.2201.09390</a>. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/016/#fnref:attentionhtr_ref" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn:remark_wer">
<p>In this case, the WER is used as a baseline to compare different approaches. However, in general, it is not a good idea to only take into account Word accuracy to understand a model's performance in real life. This is something I discussed in <a href="https://alix-tz.github.io/phd/posts/012/">this</a> post. <a class="footnote-backref" href="https://alix-tz.github.io/phd/posts/016/#fnref:remark_wer" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="https://alix-tz.github.io/phd/index-2.html" rel="next">Older posts</a>
            </li>
        </ul></nav></main><footer id="footer"><p>Contents © 2025         <a href="https://alix-tz.github.io/phd/">Alix Chagué</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> -        CC-BY<br></p>
<div>
<h3>Contact me</h3>
<form name="contact" action="https://formspree.io/mdozpzwz" method="POST">
<div>
<!--<label class="sr-only" for="inputName">Name</label>-->
<input type="text" name="name" id="inputName" placeholder="Your name" required="" style="width: 150px;">
   
<!--<label class="sr-only" for="inputEmail">E-mail</label>-->
<input type="email" name="email" id="inputEmail" placeholder="Your e-mail address" required="" style="width: 150px;">
</div>
<div>
<!--<label class="sr-only" for="inputMessage">Message</label>-->
<textarea name="message" id="inputMessage" rows="3" placeholder="Your message" required="" style="width: 50%;"></textarea>
</div>
<button type="submit" style="width: 60px;">Send</button>
</form>
</div>
            
        </footer>
</div>
    
    

    
    
    
</body>
</html>
